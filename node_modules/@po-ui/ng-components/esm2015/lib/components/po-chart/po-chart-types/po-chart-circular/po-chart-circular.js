import { __rest } from "tslib";
import { Directive, ElementRef, NgZone, Renderer2 } from '@angular/core';
import { Subject } from 'rxjs';
import { convertNumberToDecimal } from '../../../../utils/util';
import { poChartAngleStepInterval, poChartCompleteCircle, poChartDonutSerieWidth, poChartGaugeSerieWidth, poChartStartAngle } from './po-chart-circular.constant';
import { PoChartDynamicTypeComponent } from '../po-chart-dynamic-type.component';
import { PoChartType } from '../../enums/po-chart-type.enum';
import { PoSeriesTextBlack } from '../../po-chart-colors.constant';
const poChartBlackColor = '#000000';
const poChartWhiteColor = '#ffffff';
export class PoChartCircular extends PoChartDynamicTypeComponent {
    constructor(el, ngZone, renderer) {
        super();
        this.el = el;
        this.ngZone = ngZone;
        this.renderer = renderer;
        this.chartItemStartAngle = poChartStartAngle;
        this.windowResizeEmitter = new Subject();
        this.chartItemsEndAngleList = [];
        this.svgPathElementsList = [];
        this.svgTextElementsList = [];
    }
    set series(value) {
        this._series = this.getSeriesWithValue(value);
    }
    get series() {
        return this._series;
    }
    ngOnDestroy() {
        this.removeWindowResizeListener();
        this.removeWindowScrollListener();
        this.animationRunning = false;
    }
    ngOnInit() {
        this.chartInitSetup();
        this.setEventListeners();
    }
    removeTooltip() {
        if (this.tooltipElement) {
            this.renderer.addClass(this.tooltipElement, 'po-invisible');
        }
    }
    drawPath(path, chartItemStartAngle, chartItemEndAngle) {
        const largeArc = chartItemEndAngle - chartItemStartAngle > Math.PI;
        const sinAlpha = Math.sin(chartItemStartAngle);
        const cosAlpha = Math.cos(chartItemStartAngle);
        const sinBeta = Math.sin(chartItemEndAngle);
        const cosBeta = Math.cos(chartItemEndAngle);
        const startX = this.centerX + cosAlpha * this.centerX;
        const startY = this.centerX + sinAlpha * this.centerX;
        const endX = this.centerX + cosBeta * this.centerX;
        const endY = this.centerX + sinBeta * this.centerX;
        const startInnerX = this.centerX + cosAlpha * this.innerRadius;
        const startInnerY = this.centerX + sinAlpha * this.innerRadius;
        const endInnerX = this.centerX + cosBeta * this.innerRadius;
        const endInnerY = this.centerX + sinBeta * this.innerRadius;
        const halfGaugeCoordinates = [
            'M',
            startX,
            startY,
            'A',
            this.centerX,
            this.centerX,
            0,
            '0,1',
            endX,
            endY,
            'A',
            1,
            1,
            0,
            '0,1',
            endInnerX,
            endInnerY,
            'A',
            this.innerRadius,
            this.innerRadius,
            0,
            '0,0',
            startInnerX,
            startInnerY,
            'A',
            1,
            1,
            0,
            '0,1',
            startX,
            startY,
            'Z'
        ].join(' ');
        const pathCoordinates = [
            'M',
            startX,
            startY,
            'A',
            this.centerX,
            this.centerX,
            0,
            largeArc ? '1,1' : '0,1',
            endX,
            endY,
            'L',
            endInnerX,
            endInnerY,
            'A',
            this.innerRadius,
            this.innerRadius,
            0,
            largeArc ? '1,0' : '0,0',
            startInnerX,
            startInnerY,
            'Z'
        ].join(' ');
        return path.setAttribute('d', this.isChartGaugeType ? halfGaugeCoordinates : pathCoordinates);
    }
    getSeriesWithValue(series) {
        const newSeries = [];
        series.forEach((serie, index) => {
            if (serie.value > 0) {
                newSeries.push(Object.assign(Object.assign({}, serie), { color: this.colors[index] }));
            }
        });
        return newSeries;
    }
    animationSetup() {
        this.chartItemEndAngle = this.chartItemsEndAngleList[0];
        this.animationRunning = true;
        this.drawPathInit();
    }
    appendGaugeBackgroundPathElement(svgPathsWrapper) {
        const svgPath = this.renderer.createElement('svg:path', 'svg');
        this.renderer.setAttribute(svgPath, 'class', 'po-chart-gauge-base-path');
        svgPathsWrapper.appendChild(svgPath);
        this.renderer.appendChild(this.svgElement, svgPathsWrapper);
    }
    calculateAngleRadians() {
        this.series.forEach((serie, index) => (this.chartItemsEndAngleList[index] = this.calculateEndAngle(serie.value, this.totalValue)));
    }
    calculateCurrentEndAngle(angleCurrentPosition) {
        const isSerieDrawCompleted = this.chartItemStartAngle + angleCurrentPosition > this.chartItemStartAngle + this.chartItemEndAngle;
        if (isSerieDrawCompleted) {
            return this.chartItemStartAngle + this.chartItemEndAngle - poChartCompleteCircle;
        }
        else {
            return this.chartItemStartAngle + angleCurrentPosition;
        }
    }
    calculateEndAngle(value, totalValue) {
        const endAngle = (value / totalValue) * (Math.PI * 2);
        return this.isChartGaugeType ? endAngle / 2 : endAngle;
    }
    calculateSVGDimensions() {
        this.calculateSVGContainerDimensions(this.chartWrapper, this.chartHeader, this.chartLegend);
        this.innerRadius = this.setInnerRadius(this.type);
    }
    changeTooltipPosition(event) {
        if (this.tooltipElement && this.tooltipElement.classList.contains('po-invisible')) {
            this.showTooltip();
        }
        const tooltipPositions = this.setTooltipPositions(event);
        this.renderer.setStyle(this.tooltipElement, 'left', `${tooltipPositions.left}px`);
        this.renderer.setStyle(this.tooltipElement, 'top', `${tooltipPositions.top}px`);
    }
    chartInitSetup() {
        this.calculateSVGDimensions();
        this.calculateTotalValue();
        this.calculateAngleRadians();
        this.createSVGElements();
        this.animationSetup();
    }
    checkingIfScrollsWithPoPage() {
        const poPageContent = document.getElementsByClassName('po-page-content');
        return poPageContent.length ? poPageContent[0] : window;
    }
    createPath(serie, svgPathsWrapper) {
        const svgPath = this.renderer.createElement('svg:path', 'svg');
        this.renderer.setAttribute(svgPath, 'class', 'po-path-item');
        this.renderer.setAttribute(svgPath, 'fill', serie.color);
        this.setElementAttributes(svgPath, serie);
        svgPathsWrapper.appendChild(svgPath);
        this.renderer.appendChild(this.svgElement, svgPathsWrapper);
        this.svgPathElementsList.push(svgPath);
    }
    createPaths() {
        const svgPathsWrapper = this.renderer.createElement('svg:g', 'svg');
        if (this.isChartGaugeType) {
            this.appendGaugeBackgroundPathElement(svgPathsWrapper);
            // Tratamento para evitar que o path desenhe os arcos referentes ao border radius do path.
            if (this.isSerieValueEqualZero()) {
                return;
            }
        }
        this.series.forEach(serie => this.createPath(serie, svgPathsWrapper));
    }
    createText(serie) {
        const { value } = serie;
        const svgG = this.renderer.createElement('svg:g', 'svg');
        const svgText = this.renderer.createElement('svg:text', 'svg');
        const fontSize = this.getFontSize();
        const textColor = this.getTextColor(serie.color);
        svgText.textContent = this.getPercentValue(value, this.totalValue) + '%';
        this.renderer.setAttribute(svgText, 'class', 'po-path-item');
        this.renderer.setAttribute(svgText, 'fill', textColor);
        this.renderer.setAttribute(svgText, 'font-size', fontSize);
        this.renderer.setAttribute(svgText, 'fill-opacity', '0');
        this.setElementAttributes(svgText, serie);
        this.renderer.appendChild(svgG, svgText);
        this.renderer.appendChild(this.svgElement, svgG);
        this.svgTextElementsList.push(svgText);
    }
    createTexts() {
        if (this.type === PoChartType.Donut) {
            this.series.forEach(serie => this.createText(serie));
        }
    }
    createSVGElements() {
        const viewBoxHeight = this.isChartGaugeType
            ? this.centerX + this.centerX * poChartGaugeSerieWidth
            : this.chartWrapper;
        const preserveAspectRatio = this.isChartGaugeType ? 'xMidYMax' : 'xMidYMin';
        this.svgElement = this.renderer.createElement('svg:svg', 'svg');
        this.renderer.setAttribute(this.svgElement, 'viewBox', `0 0 ${this.chartWrapper} ${viewBoxHeight}`);
        this.renderer.setAttribute(this.svgElement, 'preserveAspectRatio', `${preserveAspectRatio} meet`);
        this.renderer.setAttribute(this.svgElement, 'class', 'po-chart-svg-element');
        this.renderer.setAttribute(this.svgElement, 'width', `${this.centerX}`);
        this.renderer.setAttribute(this.svgElement, 'height', `${this.svgHeight}`);
        this.svgContainer.nativeElement.appendChild(this.svgElement);
        this.createPaths();
        this.createTexts();
    }
    drawPathInit() {
        if (!this.animationRunning) {
            return;
        }
        else {
            this.ngZone.runOutsideAngular(() => this.drawSeries());
        }
    }
    drawSeries(currentSerieIndex = 0, angleCurrentPosition = 0) {
        const isFinishedDrawingCurrentSeries = angleCurrentPosition > this.chartItemEndAngle;
        const isFinishedDrawingAllSeries = currentSerieIndex === this.svgPathElementsList.length;
        if (isFinishedDrawingAllSeries) {
            return;
        }
        if (isFinishedDrawingCurrentSeries) {
            this.chartItemStartAngle = this.chartItemStartAngle + this.chartItemEndAngle;
            currentSerieIndex++;
            this.chartItemEndAngle = this.chartItemsEndAngleList[currentSerieIndex];
            angleCurrentPosition = 0;
        }
        else {
            angleCurrentPosition += poChartAngleStepInterval;
            this.drawPath(this.svgPathElementsList[currentSerieIndex], this.chartItemStartAngle, this.calculateCurrentEndAngle(angleCurrentPosition));
            this.setTextProperties(this.svgTextElementsList[currentSerieIndex], this.chartItemStartAngle, this.calculateCurrentEndAngle(angleCurrentPosition));
        }
        window.requestAnimationFrame(this.drawSeries.bind(this, currentSerieIndex, angleCurrentPosition));
    }
    emitEventOnEnter(event) {
        this.onSerieHover.next(event);
    }
    getFontSize() {
        const fontSizePorcent = 0.04;
        const fontSize = fontSizePorcent * this.chartWrapper;
        return `${fontSize.toFixed(0)}px`;
    }
    getPercentValue(value, totalValue) {
        const percentValue = (value / totalValue) * 100;
        const floatPercentValue = convertNumberToDecimal(percentValue, 2);
        return String(floatPercentValue).replace('.', ',');
    }
    getTextColor(color) {
        if (PoSeriesTextBlack.includes(color)) {
            return poChartBlackColor;
        }
        return poChartWhiteColor;
    }
    getTooltipValue(value) {
        if (this.type === PoChartType.Pie) {
            return value.toString();
        }
        return this.getPercentValue(value, this.totalValue) + '%';
    }
    isSerieValueEqualZero() {
        return this.series.length && this.series[0].value === 0;
    }
    onMouseClick() {
        let serieOnClick;
        if (this.isChartGaugeType) {
            const _a = this.series[0], { color } = _a, serie = __rest(_a, ["color"]);
            serieOnClick = serie;
        }
        else {
            serieOnClick = { category: this.chartElementCategory, value: this.chartElementValue };
        }
        this.onSerieClick.next(serieOnClick);
    }
    onMouseEnter(event) {
        let serieOnEnter;
        if (!this.isChartGaugeType) {
            this.tooltipElement = this.chartBody.nativeElement.querySelector('.po-chart-tooltip');
            this.chartElementCategory = event.target.getAttributeNS(null, 'data-tooltip-category');
            this.chartElementValue = event.target.getAttributeNS(null, 'data-tooltip-value');
            this.tooltipText = event.target.getAttributeNS(null, 'data-tooltip-text');
            this.showTooltip();
            this.changeTooltipPosition(event);
            serieOnEnter = { category: this.chartElementCategory, value: this.chartElementValue };
        }
        else {
            const _a = this.series[0], { color } = _a, serie = __rest(_a, ["color"]);
            this.chartElementDescription = event.target.getAttributeNS(null, 'data-tooltip-category');
            serieOnEnter = serie;
        }
        this.emitEventOnEnter(serieOnEnter);
    }
    onWindowResize() {
        this.calculateSVGDimensions();
        this.renderer.setAttribute(this.svgElement, 'width', `${this.centerX}`);
        this.renderer.setAttribute(this.svgElement, 'height', `${this.svgHeight}`);
        this.windowResizeEmitter.next();
    }
    removeWindowResizeListener() {
        if (this.windowResizeListener) {
            this.windowResizeListener();
        }
    }
    removeWindowScrollListener() {
        if (this.windowScrollListener) {
            this.windowScrollListener();
        }
    }
    setEventListeners() {
        let chartSeries = this.el.nativeElement.querySelectorAll('.po-path-item');
        chartSeries = Array.from(chartSeries);
        chartSeries.forEach(serie => {
            this.renderer.listen(serie, 'click', this.onMouseClick.bind(this));
            this.renderer.listen(serie, 'mouseenter', this.onMouseEnter.bind(this));
            if (!this.isChartGaugeType) {
                this.renderer.listen(serie, 'mousemove', this.changeTooltipPosition.bind(this));
                this.renderer.listen(serie, 'mouseleave', this.removeTooltip.bind(this));
            }
        });
        this.windowResizeListener = this.renderer.listen(window, 'resize', this.onWindowResize.bind(this));
        this.windowScrollListener = this.renderer.listen(this.checkingIfScrollsWithPoPage(), 'scroll', this.removeTooltip.bind(this));
    }
    setInnerRadius(type) {
        let serieWidth;
        switch (type) {
            case PoChartType.Donut: {
                serieWidth = poChartDonutSerieWidth;
                break;
            }
            case PoChartType.Gauge: {
                serieWidth = poChartGaugeSerieWidth;
                break;
            }
            case PoChartType.Pie: {
                return 0;
            }
        }
        return this.centerX - this.centerX * serieWidth;
    }
    setTextProperties(text, startAngle, endAngle) {
        // necessário text.getClientRects().length para contornar erro de console causado no Firefox
        if (this.type === PoChartType.Donut && text.getClientRects().length) {
            // utilizado para recuperar o angulo do meio, entre o inicio e fim para centralizar o texto
            const centerAngle = (startAngle + endAngle) / 2;
            const textBox = text.getBBox();
            const halfTextWidth = textBox.width / 2;
            const halfTextHeight = textBox.height / 2;
            // radius interno (circulo branco) + a metade da diferença entre tamanho do centro e radius interno
            const radius = this.innerRadius + (this.centerX - this.innerRadius) / 2;
            const xCoordinate = radius * Math.cos(centerAngle) + this.centerX - halfTextWidth;
            const yCoordinate = radius * Math.sin(centerAngle) + this.centerX + halfTextHeight / 2;
            text.setAttribute('x', xCoordinate);
            text.setAttribute('y', yCoordinate);
            text.setAttribute('fill-opacity', '1');
        }
    }
    setTooltipPositions(event) {
        const displacement = 8;
        return {
            left: event.clientX - this.tooltipElement.offsetWidth / 2,
            top: event.clientY - this.tooltipElement.offsetHeight - displacement
        };
    }
    setElementAttributes(svgElement, serie) {
        const { value, category, tooltip, description } = serie;
        this.renderer.setAttribute(svgElement, 'data-tooltip-value', `${value}`);
        if (this.isChartGaugeType) {
            this.renderer.setAttribute(svgElement, 'data-tooltip-description', description);
        }
        else {
            const tooltipValue = this.getTooltipValue(value);
            this.renderer.setAttribute(svgElement, 'data-tooltip-category', category);
            this.renderer.setAttribute(svgElement, 'data-tooltip-text', tooltip || `${category}: ${tooltipValue}`);
        }
    }
    showTooltip() {
        this.renderer.removeClass(this.tooltipElement, 'po-invisible');
    }
}
PoChartCircular.decorators = [
    { type: Directive }
];
PoChartCircular.ctorParameters = () => [
    { type: ElementRef },
    { type: NgZone },
    { type: Renderer2 }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tY2hhcnQtY2lyY3VsYXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy91aS9zcmMvbGliL2NvbXBvbmVudHMvcG8tY2hhcnQvcG8tY2hhcnQtdHlwZXMvcG8tY2hhcnQtY2lyY3VsYXIvcG8tY2hhcnQtY2lyY3VsYXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBcUIsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzVGLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFFL0IsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFFaEUsT0FBTyxFQUNMLHdCQUF3QixFQUN4QixxQkFBcUIsRUFDckIsc0JBQXNCLEVBQ3RCLHNCQUFzQixFQUV0QixpQkFBaUIsRUFDbEIsTUFBTSw4QkFBOEIsQ0FBQztBQUN0QyxPQUFPLEVBQUUsMkJBQTJCLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQztBQUVqRixPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFJN0QsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFFbkUsTUFBTSxpQkFBaUIsR0FBRyxTQUFTLENBQUM7QUFDcEMsTUFBTSxpQkFBaUIsR0FBRyxTQUFTLENBQUM7QUFHcEMsTUFBTSxPQUFPLGVBQWdCLFNBQVEsMkJBQTJCO0lBcUI5RCxZQUFzQixFQUFjLEVBQVUsTUFBYyxFQUFVLFFBQW1CO1FBQ3ZGLEtBQUssRUFBRSxDQUFDO1FBRFksT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQUFVLFdBQU0sR0FBTixNQUFNLENBQVE7UUFBVSxhQUFRLEdBQVIsUUFBUSxDQUFXO1FBcEJ6Rix3QkFBbUIsR0FBRyxpQkFBaUIsQ0FBQztRQUN4Qyx3QkFBbUIsR0FBaUIsSUFBSSxPQUFPLEVB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QUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRSxjQUFjLENBQUMsQ0FBQztJQUNqRSxDQUFDOzs7WUExZkYsU0FBUzs7O1lBeEJVLFVBQVU7WUFBRSxNQUFNO1lBQXFCLFNBQVMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEaXJlY3RpdmUsIEVsZW1lbnRSZWYsIE5nWm9uZSwgT25EZXN0cm95LCBPbkluaXQsIFJlbmRlcmVyMiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBjb252ZXJ0TnVtYmVyVG9EZWNpbWFsIH0gZnJvbSAnLi4vLi4vLi4vLi4vdXRpbHMvdXRpbCc7XG5cbmltcG9ydCB7XG4gIHBvQ2hhcnRBbmdsZVN0ZXBJbnRlcnZhbCxcbiAgcG9DaGFydENvbXBsZXRlQ2lyY2xlLFxuICBwb0NoYXJ0RG9udXRTZXJpZVdpZHRoLFxuICBwb0NoYXJ0R2F1Z2VTZXJpZVdpZHRoLFxuICBwb0NoYXJ0UGFkZGluZyxcbiAgcG9DaGFydFN0YXJ0QW5nbGVcbn0gZnJvbSAnLi9wby1jaGFydC1jaXJjdWxhci5jb25zdGFudCc7XG5pbXBvcnQgeyBQb0NoYXJ0RHluYW1pY1R5cGVDb21wb25lbnQgfSBmcm9tICcuLi9wby1jaGFydC1keW5hbWljLXR5cGUuY29tcG9uZW50JztcbmltcG9ydCB7IFBvQ2hhcnRHYXVnZVNlcmllIH0gZnJvbSAnLi4vcG8tY2hhcnQtZ2F1Z2UvcG8tY2hhcnQtZ2F1Z2Utc2VyaWVzLmludGVyZmFjZSc7XG5pbXBvcnQgeyBQb0NoYXJ0VHlwZSB9IGZyb20gJy4uLy4uL2VudW1zL3BvLWNoYXJ0LXR5cGUuZW51bSc7XG5pbXBvcnQgeyBQb0NpcmN1bGFyQ2hhcnRTZXJpZXMgfSBmcm9tICcuL3BvLWNoYXJ0LWNpcmN1bGFyLXNlcmllcy5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9Eb251dENoYXJ0U2VyaWVzIH0gZnJvbSAnLi4vcG8tY2hhcnQtZG9udXQvcG8tY2hhcnQtZG9udXQtc2VyaWVzLmludGVyZmFjZSc7XG5pbXBvcnQgeyBQb1BpZUNoYXJ0U2VyaWVzIH0gZnJvbSAnLi4vcG8tY2hhcnQtcGllL3BvLWNoYXJ0LXBpZS1zZXJpZXMuaW50ZXJmYWNlJztcbmltcG9ydCB7IFBvU2VyaWVzVGV4dEJsYWNrIH0gZnJvbSAnLi4vLi4vcG8tY2hhcnQtY29sb3JzLmNvbnN0YW50JztcblxuY29uc3QgcG9DaGFydEJsYWNrQ29sb3IgPSAnIzAwMDAwMCc7XG5jb25zdCBwb0NoYXJ0V2hpdGVDb2xvciA9ICcjZmZmZmZmJztcblxuQERpcmVjdGl2ZSgpXG5leHBvcnQgY2xhc3MgUG9DaGFydENpcmN1bGFyIGV4dGVuZHMgUG9DaGFydER5bmFtaWNUeXBlQ29tcG9uZW50IGltcGxlbWVudHMgT25EZXN0cm95LCBPbkluaXQge1xuICBjaGFydEl0ZW1TdGFydEFuZ2xlID0gcG9DaGFydFN0YXJ0QW5nbGU7XG4gIHdpbmRvd1Jlc2l6ZUVtaXR0ZXI6IFN1YmplY3Q8YW55PiA9IG5ldyBTdWJqZWN0KCk7XG5cbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiB1c2UtdHlwZS1hbGlhc1xuICBwcm90ZWN0ZWQgX3NlcmllczogQXJyYXk8UG9QaWVDaGFydFNlcmllcyB8IFBvRG9udXRDaGFydFNlcmllcyB8IFBvQ2hhcnRHYXVnZVNlcmllPjtcblxuICBwcml2YXRlIGFuaW1hdGlvblJ1bm5pbmc6IGJvb2xlYW47XG4gIHByaXZhdGUgY2hhcnRJdGVtRW5kQW5nbGU6IG51bWJlcjtcbiAgcHJpdmF0ZSBjaGFydEl0ZW1zRW5kQW5nbGVMaXN0OiBBcnJheTxudW1iZXI+ID0gW107XG4gIHByaXZhdGUgc3ZnUGF0aEVsZW1lbnRzTGlzdDogQXJyYXk8c3RyaW5nPiA9IFtdO1xuICBwcml2YXRlIHN2Z1RleHRFbGVtZW50c0xpc3Q6IEFycmF5PHN0cmluZz4gPSBbXTtcblxuICBzZXQgc2VyaWVzKHZhbHVlOiBBcnJheTxQb1BpZUNoYXJ0U2VyaWVzIHwgUG9Eb251dENoYXJ0U2VyaWVzIHwgUG9DaGFydEdhdWdlU2VyaWU+KSB7XG4gICAgdGhpcy5fc2VyaWVzID0gdGhpcy5nZXRTZXJpZXNXaXRoVmFsdWUodmFsdWUpO1xuICB9XG5cbiAgZ2V0IHNlcmllcygpIHtcbiAgICByZXR1cm4gdGhpcy5fc2VyaWVzO1xuICB9XG5cbiAgY29uc3RydWN0b3IocHJvdGVjdGVkIGVsOiBFbGVtZW50UmVmLCBwcml2YXRlIG5nWm9uZTogTmdab25lLCBwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjIpIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5yZW1vdmVXaW5kb3dSZXNpemVMaXN0ZW5lcigpO1xuICAgIHRoaXMucmVtb3ZlV2luZG93U2Nyb2xsTGlzdGVuZXIoKTtcbiAgICB0aGlzLmFuaW1hdGlvblJ1bm5pbmcgPSBmYWxzZTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuY2hhcnRJbml0U2V0dXAoKTtcbiAgICB0aGlzLnNldEV2ZW50TGlzdGVuZXJzKCk7XG4gIH1cblxuICByZW1vdmVUb29sdGlwKCkge1xuICAgIGlmICh0aGlzLnRvb2x0aXBFbGVtZW50KSB7XG4gICAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKHRoaXMudG9vbHRpcEVsZW1lbnQsICdwby1pbnZpc2libGUnKTtcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgZHJhd1BhdGgocGF0aCwgY2hhcnRJdGVtU3RhcnRBbmdsZSwgY2hhcnRJdGVtRW5kQW5nbGUpIHtcbiAgICBjb25zdCBsYXJnZUFyYyA9IGNoYXJ0SXRlbUVuZEFuZ2xlIC0gY2hhcnRJdGVtU3RhcnRBbmdsZSA+IE1hdGguUEk7XG5cbiAgICBjb25zdCBzaW5BbHBoYSA9IE1hdGguc2luKGNoYXJ0SXRlbVN0YXJ0QW5nbGUpO1xuICAgIGNvbnN0IGNvc0FscGhhID0gTWF0aC5jb3MoY2hhcnRJdGVtU3RhcnRBbmdsZSk7XG5cbiAgICBjb25zdCBzaW5CZXRhID0gTWF0aC5zaW4oY2hhcnRJdGVtRW5kQW5nbGUpO1xuICAgIGNvbnN0IGNvc0JldGEgPSBNYXRoLmNvcyhjaGFydEl0ZW1FbmRBbmdsZSk7XG5cbiAgICBjb25zdCBzdGFydFggPSB0aGlzLmNlbnRlclggKyBjb3NBbHBoYSAqIHRoaXMuY2VudGVyWDtcbiAgICBjb25zdCBzdGFydFkgPSB0aGlzLmNlbnRlclggKyBzaW5BbHBoYSAqIHRoaXMuY2VudGVyWDtcblxuICAgIGNvbnN0IGVuZFggPSB0aGlzLmNlbnRlclggKyBjb3NCZXRhICogdGhpcy5jZW50ZXJYO1xuICAgIGNvbnN0IGVuZFkgPSB0aGlzLmNlbnRlclggKyBzaW5CZXRhICogdGhpcy5jZW50ZXJYO1xuXG4gICAgY29uc3Qgc3RhcnRJbm5lclggPSB0aGlzLmNlbnRlclggKyBjb3NBbHBoYSAqIHRoaXMuaW5uZXJSYWRpdXM7XG4gICAgY29uc3Qgc3RhcnRJbm5lclkgPSB0aGlzLmNlbnRlclggKyBzaW5BbHBoYSAqIHRoaXMuaW5uZXJSYWRpdXM7XG5cbiAgICBjb25zdCBlbmRJbm5lclggPSB0aGlzLmNlbnRlclggKyBjb3NCZXRhICogdGhpcy5pbm5lclJhZGl1cztcbiAgICBjb25zdCBlbmRJbm5lclkgPSB0aGlzLmNlbnRlclggKyBzaW5CZXRhICogdGhpcy5pbm5lclJhZGl1cztcblxuICAgIGNvbnN0IGhhbGZHYXVnZUNvb3JkaW5hdGVzID0gW1xuICAgICAgJ00nLFxuICAgICAgc3RhcnRYLFxuICAgICAgc3RhcnRZLFxuICAgICAgJ0EnLFxuICAgICAgdGhpcy5jZW50ZXJYLFxuICAgICAgdGhpcy5jZW50ZXJYLFxuICAgICAgMCxcbiAgICAgICcwLDEnLFxuICAgICAgZW5kWCxcbiAgICAgIGVuZFksXG4gICAgICAnQScsXG4gICAgICAxLFxuICAgICAgMSxcbiAgICAgIDAsXG4gICAgICAnMCwxJyxcbiAgICAgIGVuZElubmVyWCxcbiAgICAgIGVuZElubmVyWSxcbiAgICAgICdBJyxcbiAgICAgIHRoaXMuaW5uZXJSYWRpdXMsXG4gICAgICB0aGlzLmlubmVyUmFkaXVzLFxuICAgICAgMCxcbiAgICAgICcwLDAnLFxuICAgICAgc3RhcnRJbm5lclgsXG4gICAgICBzdGFydElubmVyWSxcbiAgICAgICdBJyxcbiAgICAgIDEsXG4gICAgICAxLFxuICAgICAgMCxcbiAgICAgICcwLDEnLFxuICAgICAgc3RhcnRYLFxuICAgICAgc3RhcnRZLFxuICAgICAgJ1onXG4gICAgXS5qb2luKCcgJyk7XG5cbiAgICBjb25zdCBwYXRoQ29vcmRpbmF0ZXMgPSBbXG4gICAgICAnTScsXG4gICAgICBzdGFydFgsXG4gICAgICBzdGFydFksXG4gICAgICAnQScsXG4gICAgICB0aGlzLmNlbnRlclgsXG4gICAgICB0aGlzLmNlbnRlclgsXG4gICAgICAwLFxuICAgICAgbGFyZ2VBcmMgPyAnMSwxJyA6ICcwLDEnLFxuICAgICAgZW5kWCxcbiAgICAgIGVuZFksXG4gICAgICAnTCcsXG4gICAgICBlbmRJbm5lclgsXG4gICAgICBlbmRJbm5lclksXG4gICAgICAnQScsXG4gICAgICB0aGlzLmlubmVyUmFkaXVzLFxuICAgICAgdGhpcy5pbm5lclJhZGl1cyxcbiAgICAgIDAsXG4gICAgICBsYXJnZUFyYyA/ICcxLDAnIDogJzAsMCcsXG4gICAgICBzdGFydElubmVyWCxcbiAgICAgIHN0YXJ0SW5uZXJZLFxuICAgICAgJ1onXG4gICAgXS5qb2luKCcgJyk7XG5cbiAgICByZXR1cm4gcGF0aC5zZXRBdHRyaWJ1dGUoJ2QnLCB0aGlzLmlzQ2hhcnRHYXVnZVR5cGUgPyBoYWxmR2F1Z2VDb29yZGluYXRlcyA6IHBhdGhDb29yZGluYXRlcyk7XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0U2VyaWVzV2l0aFZhbHVlKHNlcmllczogQXJyYXk8UG9DaXJjdWxhckNoYXJ0U2VyaWVzIHwgUG9DaGFydEdhdWdlU2VyaWU+KSB7XG4gICAgY29uc3QgbmV3U2VyaWVzID0gW107XG5cbiAgICBzZXJpZXMuZm9yRWFjaCgoc2VyaWUsIGluZGV4KSA9PiB7XG4gICAgICBpZiAoc2VyaWUudmFsdWUgPiAwKSB7XG4gICAgICAgIG5ld1Nlcmllcy5wdXNoKHsgLi4uc2VyaWUsIGNvbG9yOiB0aGlzLmNvbG9yc1tpbmRleF0gfSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gbmV3U2VyaWVzO1xuICB9XG5cbiAgcHJpdmF0ZSBhbmltYXRpb25TZXR1cCgpIHtcbiAgICB0aGlzLmNoYXJ0SXRlbUVuZEFuZ2xlID0gdGhpcy5jaGFydEl0ZW1zRW5kQW5nbGVMaXN0WzBdO1xuICAgIHRoaXMuYW5pbWF0aW9uUnVubmluZyA9IHRydWU7XG4gICAgdGhpcy5kcmF3UGF0aEluaXQoKTtcbiAgfVxuXG4gIHByaXZhdGUgYXBwZW5kR2F1Z2VCYWNrZ3JvdW5kUGF0aEVsZW1lbnQoc3ZnUGF0aHNXcmFwcGVyOiBhbnkpIHtcbiAgICBjb25zdCBzdmdQYXRoID0gdGhpcy5yZW5kZXJlci5jcmVhdGVFbGVtZW50KCdzdmc6cGF0aCcsICdzdmcnKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZShzdmdQYXRoLCAnY2xhc3MnLCAncG8tY2hhcnQtZ2F1Z2UtYmFzZS1wYXRoJyk7XG4gICAgc3ZnUGF0aHNXcmFwcGVyLmFwcGVuZENoaWxkKHN2Z1BhdGgpO1xuICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQodGhpcy5zdmdFbGVtZW50LCBzdmdQYXRoc1dyYXBwZXIpO1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVBbmdsZVJhZGlhbnMoKSB7XG4gICAgdGhpcy5zZXJpZXMuZm9yRWFjaChcbiAgICAgIChzZXJpZSwgaW5kZXgpID0+ICh0aGlzLmNoYXJ0SXRlbXNFbmRBbmdsZUxpc3RbaW5kZXhdID0gdGhpcy5jYWxjdWxhdGVFbmRBbmdsZShzZXJpZS52YWx1ZSwgdGhpcy50b3RhbFZhbHVlKSlcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVDdXJyZW50RW5kQW5nbGUoYW5nbGVDdXJyZW50UG9zaXRpb246IG51bWJlcikge1xuICAgIGNvbnN0IGlzU2VyaWVEcmF3Q29tcGxldGVkID1cbiAgICAgIHRoaXMuY2hhcnRJdGVtU3RhcnRBbmdsZSArIGFuZ2xlQ3VycmVudFBvc2l0aW9uID4gdGhpcy5jaGFydEl0ZW1TdGFydEFuZ2xlICsgdGhpcy5jaGFydEl0ZW1FbmRBbmdsZTtcblxuICAgIGlmIChpc1NlcmllRHJhd0NvbXBsZXRlZCkge1xuICAgICAgcmV0dXJuIHRoaXMuY2hhcnRJdGVtU3RhcnRBbmdsZSArIHRoaXMuY2hhcnRJdGVtRW5kQW5nbGUgLSBwb0NoYXJ0Q29tcGxldGVDaXJjbGU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0aGlzLmNoYXJ0SXRlbVN0YXJ0QW5nbGUgKyBhbmdsZUN1cnJlbnRQb3NpdGlvbjtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZUVuZEFuZ2xlKHZhbHVlOiBudW1iZXIsIHRvdGFsVmFsdWU6IG51bWJlcik6IG51bWJlciB7XG4gICAgY29uc3QgZW5kQW5nbGUgPSAodmFsdWUgLyB0b3RhbFZhbHVlKSAqIChNYXRoLlBJICogMik7XG5cbiAgICByZXR1cm4gdGhpcy5pc0NoYXJ0R2F1Z2VUeXBlID8gZW5kQW5nbGUgLyAyIDogZW5kQW5nbGU7XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZVNWR0RpbWVuc2lvbnMoKSB7XG4gICAgdGhpcy5jYWxjdWxhdGVTVkdDb250YWluZXJEaW1lbnNpb25zKHRoaXMuY2hhcnRXcmFwcGVyLCB0aGlzLmNoYXJ0SGVhZGVyLCB0aGlzLmNoYXJ0TGVnZW5kKTtcblxuICAgIHRoaXMuaW5uZXJSYWRpdXMgPSB0aGlzLnNldElubmVyUmFkaXVzKHRoaXMudHlwZSk7XG4gIH1cblxuICBwcml2YXRlIGNoYW5nZVRvb2x0aXBQb3NpdGlvbihldmVudDogTW91c2VFdmVudCkge1xuICAgIGlmICh0aGlzLnRvb2x0aXBFbGVtZW50ICYmIHRoaXMudG9vbHRpcEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdwby1pbnZpc2libGUnKSkge1xuICAgICAgdGhpcy5zaG93VG9vbHRpcCgpO1xuICAgIH1cblxuICAgIGNvbnN0IHRvb2x0aXBQb3NpdGlvbnMgPSB0aGlzLnNldFRvb2x0aXBQb3NpdGlvbnMoZXZlbnQpO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy50b29sdGlwRWxlbWVudCwgJ2xlZnQnLCBgJHt0b29sdGlwUG9zaXRpb25zLmxlZnR9cHhgKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMudG9vbHRpcEVsZW1lbnQsICd0b3AnLCBgJHt0b29sdGlwUG9zaXRpb25zLnRvcH1weGApO1xuICB9XG5cbiAgcHJpdmF0ZSBjaGFydEluaXRTZXR1cCgpIHtcbiAgICB0aGlzLmNhbGN1bGF0ZVNWR0RpbWVuc2lvbnMoKTtcbiAgICB0aGlzLmNhbGN1bGF0ZVRvdGFsVmFsdWUoKTtcbiAgICB0aGlzLmNhbGN1bGF0ZUFuZ2xlUmFkaWFucygpO1xuICAgIHRoaXMuY3JlYXRlU1ZHRWxlbWVudHMoKTtcbiAgICB0aGlzLmFuaW1hdGlvblNldHVwKCk7XG4gIH1cblxuICBwcml2YXRlIGNoZWNraW5nSWZTY3JvbGxzV2l0aFBvUGFnZSgpIHtcbiAgICBjb25zdCBwb1BhZ2VDb250ZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgncG8tcGFnZS1jb250ZW50Jyk7XG5cbiAgICByZXR1cm4gcG9QYWdlQ29udGVudC5sZW5ndGggPyBwb1BhZ2VDb250ZW50WzBdIDogd2luZG93O1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVQYXRoKHNlcmllOiBQb0NpcmN1bGFyQ2hhcnRTZXJpZXMgfCBQb0NoYXJ0R2F1Z2VTZXJpZSwgc3ZnUGF0aHNXcmFwcGVyOiBhbnkpIHtcbiAgICBjb25zdCBzdmdQYXRoID0gdGhpcy5yZW5kZXJlci5jcmVhdGVFbGVtZW50KCdzdmc6cGF0aCcsICdzdmcnKTtcblxuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHN2Z1BhdGgsICdjbGFzcycsICdwby1wYXRoLWl0ZW0nKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZShzdmdQYXRoLCAnZmlsbCcsIHNlcmllLmNvbG9yKTtcblxuICAgIHRoaXMuc2V0RWxlbWVudEF0dHJpYnV0ZXMoc3ZnUGF0aCwgc2VyaWUpO1xuXG4gICAgc3ZnUGF0aHNXcmFwcGVyLmFwcGVuZENoaWxkKHN2Z1BhdGgpO1xuXG4gICAgdGhpcy5yZW5kZXJlci5hcHBlbmRDaGlsZCh0aGlzLnN2Z0VsZW1lbnQsIHN2Z1BhdGhzV3JhcHBlcik7XG5cbiAgICB0aGlzLnN2Z1BhdGhFbGVtZW50c0xpc3QucHVzaChzdmdQYXRoKTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlUGF0aHMoKSB7XG4gICAgY29uc3Qgc3ZnUGF0aHNXcmFwcGVyID0gdGhpcy5yZW5kZXJlci5jcmVhdGVFbGVtZW50KCdzdmc6ZycsICdzdmcnKTtcblxuICAgIGlmICh0aGlzLmlzQ2hhcnRHYXVnZVR5cGUpIHtcbiAgICAgIHRoaXMuYXBwZW5kR2F1Z2VCYWNrZ3JvdW5kUGF0aEVsZW1lbnQoc3ZnUGF0aHNXcmFwcGVyKTtcbiAgICAgIC8vIFRyYXRhbWVudG8gcGFyYSBldml0YXIgcXVlIG8gcGF0aCBkZXNlbmhlIG9zIGFyY29zIHJlZmVyZW50ZXMgYW8gYm9yZGVyIHJhZGl1cyBkbyBwYXRoLlxuICAgICAgaWYgKHRoaXMuaXNTZXJpZVZhbHVlRXF1YWxaZXJvKCkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuc2VyaWVzLmZvckVhY2goc2VyaWUgPT4gdGhpcy5jcmVhdGVQYXRoKHNlcmllLCBzdmdQYXRoc1dyYXBwZXIpKTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlVGV4dChzZXJpZTogUG9DaXJjdWxhckNoYXJ0U2VyaWVzIHwgUG9DaGFydEdhdWdlU2VyaWUpIHtcbiAgICBjb25zdCB7IHZhbHVlIH0gPSBzZXJpZTtcblxuICAgIGNvbnN0IHN2Z0cgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ3N2ZzpnJywgJ3N2ZycpO1xuICAgIGNvbnN0IHN2Z1RleHQgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ3N2Zzp0ZXh0JywgJ3N2ZycpO1xuXG4gICAgY29uc3QgZm9udFNpemUgPSB0aGlzLmdldEZvbnRTaXplKCk7XG4gICAgY29uc3QgdGV4dENvbG9yID0gdGhpcy5nZXRUZXh0Q29sb3Ioc2VyaWUuY29sb3IpO1xuXG4gICAgc3ZnVGV4dC50ZXh0Q29udGVudCA9IHRoaXMuZ2V0UGVyY2VudFZhbHVlKHZhbHVlLCB0aGlzLnRvdGFsVmFsdWUpICsgJyUnO1xuXG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUoc3ZnVGV4dCwgJ2NsYXNzJywgJ3BvLXBhdGgtaXRlbScpO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHN2Z1RleHQsICdmaWxsJywgdGV4dENvbG9yKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZShzdmdUZXh0LCAnZm9udC1zaXplJywgZm9udFNpemUpO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHN2Z1RleHQsICdmaWxsLW9wYWNpdHknLCAnMCcpO1xuXG4gICAgdGhpcy5zZXRFbGVtZW50QXR0cmlidXRlcyhzdmdUZXh0LCBzZXJpZSk7XG5cbiAgICB0aGlzLnJlbmRlcmVyLmFwcGVuZENoaWxkKHN2Z0csIHN2Z1RleHQpO1xuXG4gICAgdGhpcy5yZW5kZXJlci5hcHBlbmRDaGlsZCh0aGlzLnN2Z0VsZW1lbnQsIHN2Z0cpO1xuICAgIHRoaXMuc3ZnVGV4dEVsZW1lbnRzTGlzdC5wdXNoKHN2Z1RleHQpO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVUZXh0cygpIHtcbiAgICBpZiAodGhpcy50eXBlID09PSBQb0NoYXJ0VHlwZS5Eb251dCkge1xuICAgICAgdGhpcy5zZXJpZXMuZm9yRWFjaChzZXJpZSA9PiB0aGlzLmNyZWF0ZVRleHQoc2VyaWUpKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVNWR0VsZW1lbnRzKCkge1xuICAgIGNvbnN0IHZpZXdCb3hIZWlnaHQgPSB0aGlzLmlzQ2hhcnRHYXVnZVR5cGVcbiAgICAgID8gdGhpcy5jZW50ZXJYICsgdGhpcy5jZW50ZXJYICogcG9DaGFydEdhdWdlU2VyaWVXaWR0aFxuICAgICAgOiB0aGlzLmNoYXJ0V3JhcHBlcjtcbiAgICBjb25zdCBwcmVzZXJ2ZUFzcGVjdFJhdGlvID0gdGhpcy5pc0NoYXJ0R2F1Z2VUeXBlID8gJ3hNaWRZTWF4JyA6ICd4TWlkWU1pbic7XG5cbiAgICB0aGlzLnN2Z0VsZW1lbnQgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ3N2ZzpzdmcnLCAnc3ZnJyk7XG5cbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZSh0aGlzLnN2Z0VsZW1lbnQsICd2aWV3Qm94JywgYDAgMCAke3RoaXMuY2hhcnRXcmFwcGVyfSAke3ZpZXdCb3hIZWlnaHR9YCk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUodGhpcy5zdmdFbGVtZW50LCAncHJlc2VydmVBc3BlY3RSYXRpbycsIGAke3ByZXNlcnZlQXNwZWN0UmF0aW99IG1lZXRgKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZSh0aGlzLnN2Z0VsZW1lbnQsICdjbGFzcycsICdwby1jaGFydC1zdmctZWxlbWVudCcpO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHRoaXMuc3ZnRWxlbWVudCwgJ3dpZHRoJywgYCR7dGhpcy5jZW50ZXJYfWApO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHRoaXMuc3ZnRWxlbWVudCwgJ2hlaWdodCcsIGAke3RoaXMuc3ZnSGVpZ2h0fWApO1xuXG4gICAgdGhpcy5zdmdDb250YWluZXIubmF0aXZlRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLnN2Z0VsZW1lbnQpO1xuXG4gICAgdGhpcy5jcmVhdGVQYXRocygpO1xuICAgIHRoaXMuY3JlYXRlVGV4dHMoKTtcbiAgfVxuXG4gIHByaXZhdGUgZHJhd1BhdGhJbml0KCkge1xuICAgIGlmICghdGhpcy5hbmltYXRpb25SdW5uaW5nKSB7XG4gICAgICByZXR1cm47XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHRoaXMuZHJhd1NlcmllcygpKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGRyYXdTZXJpZXMoY3VycmVudFNlcmllSW5kZXg6IG51bWJlciA9IDAsIGFuZ2xlQ3VycmVudFBvc2l0aW9uOiBudW1iZXIgPSAwKSB7XG4gICAgY29uc3QgaXNGaW5pc2hlZERyYXdpbmdDdXJyZW50U2VyaWVzID0gYW5nbGVDdXJyZW50UG9zaXRpb24gPiB0aGlzLmNoYXJ0SXRlbUVuZEFuZ2xlO1xuICAgIGNvbnN0IGlzRmluaXNoZWREcmF3aW5nQWxsU2VyaWVzID0gY3VycmVudFNlcmllSW5kZXggPT09IHRoaXMuc3ZnUGF0aEVsZW1lbnRzTGlzdC5sZW5ndGg7XG5cbiAgICBpZiAoaXNGaW5pc2hlZERyYXdpbmdBbGxTZXJpZXMpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoaXNGaW5pc2hlZERyYXdpbmdDdXJyZW50U2VyaWVzKSB7XG4gICAgICB0aGlzLmNoYXJ0SXRlbVN0YXJ0QW5nbGUgPSB0aGlzLmNoYXJ0SXRlbVN0YXJ0QW5nbGUgKyB0aGlzLmNoYXJ0SXRlbUVuZEFuZ2xlO1xuICAgICAgY3VycmVudFNlcmllSW5kZXgrKztcbiAgICAgIHRoaXMuY2hhcnRJdGVtRW5kQW5nbGUgPSB0aGlzLmNoYXJ0SXRlbXNFbmRBbmdsZUxpc3RbY3VycmVudFNlcmllSW5kZXhdO1xuICAgICAgYW5nbGVDdXJyZW50UG9zaXRpb24gPSAwO1xuICAgIH0gZWxzZSB7XG4gICAgICBhbmdsZUN1cnJlbnRQb3NpdGlvbiArPSBwb0NoYXJ0QW5nbGVTdGVwSW50ZXJ2YWw7XG5cbiAgICAgIHRoaXMuZHJhd1BhdGgoXG4gICAgICAgIHRoaXMuc3ZnUGF0aEVsZW1lbnRzTGlzdFtjdXJyZW50U2VyaWVJbmRleF0sXG4gICAgICAgIHRoaXMuY2hhcnRJdGVtU3RhcnRBbmdsZSxcbiAgICAgICAgdGhpcy5jYWxjdWxhdGVDdXJyZW50RW5kQW5nbGUoYW5nbGVDdXJyZW50UG9zaXRpb24pXG4gICAgICApO1xuXG4gICAgICB0aGlzLnNldFRleHRQcm9wZXJ0aWVzKFxuICAgICAgICB0aGlzLnN2Z1RleHRFbGVtZW50c0xpc3RbY3VycmVudFNlcmllSW5kZXhdLFxuICAgICAgICB0aGlzLmNoYXJ0SXRlbVN0YXJ0QW5nbGUsXG4gICAgICAgIHRoaXMuY2FsY3VsYXRlQ3VycmVudEVuZEFuZ2xlKGFuZ2xlQ3VycmVudFBvc2l0aW9uKVxuICAgICAgKTtcbiAgICB9XG5cbiAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMuZHJhd1Nlcmllcy5iaW5kKHRoaXMsIGN1cnJlbnRTZXJpZUluZGV4LCBhbmdsZUN1cnJlbnRQb3NpdGlvbikpO1xuICB9XG5cbiAgcHJpdmF0ZSBlbWl0RXZlbnRPbkVudGVyKGV2ZW50OiBQb0RvbnV0Q2hhcnRTZXJpZXMgfCBQb1BpZUNoYXJ0U2VyaWVzIHwgUG9DaGFydEdhdWdlU2VyaWUpIHtcbiAgICB0aGlzLm9uU2VyaWVIb3Zlci5uZXh0KGV2ZW50KTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0Rm9udFNpemUoKSB7XG4gICAgY29uc3QgZm9udFNpemVQb3JjZW50ID0gMC4wNDtcblxuICAgIGNvbnN0IGZvbnRTaXplID0gZm9udFNpemVQb3JjZW50ICogdGhpcy5jaGFydFdyYXBwZXI7XG5cbiAgICByZXR1cm4gYCR7Zm9udFNpemUudG9GaXhlZCgwKX1weGA7XG4gIH1cblxuICBwcml2YXRlIGdldFBlcmNlbnRWYWx1ZSh2YWx1ZTogbnVtYmVyLCB0b3RhbFZhbHVlOiBudW1iZXIpIHtcbiAgICBjb25zdCBwZXJjZW50VmFsdWUgPSAodmFsdWUgLyB0b3RhbFZhbHVlKSAqIDEwMDtcblxuICAgIGNvbnN0IGZsb2F0UGVyY2VudFZhbHVlID0gY29udmVydE51bWJlclRvRGVjaW1hbChwZXJjZW50VmFsdWUsIDIpO1xuXG4gICAgcmV0dXJuIFN0cmluZyhmbG9hdFBlcmNlbnRWYWx1ZSkucmVwbGFjZSgnLicsICcsJyk7XG4gIH1cblxuICBwcml2YXRlIGdldFRleHRDb2xvcihjb2xvcjogc3RyaW5nKSB7XG4gICAgaWYgKFBvU2VyaWVzVGV4dEJsYWNrLmluY2x1ZGVzKGNvbG9yKSkge1xuICAgICAgcmV0dXJuIHBvQ2hhcnRCbGFja0NvbG9yO1xuICAgIH1cblxuICAgIHJldHVybiBwb0NoYXJ0V2hpdGVDb2xvcjtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0VG9vbHRpcFZhbHVlKHZhbHVlOiBudW1iZXIpIHtcbiAgICBpZiAodGhpcy50eXBlID09PSBQb0NoYXJ0VHlwZS5QaWUpIHtcbiAgICAgIHJldHVybiB2YWx1ZS50b1N0cmluZygpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmdldFBlcmNlbnRWYWx1ZSh2YWx1ZSwgdGhpcy50b3RhbFZhbHVlKSArICclJztcbiAgfVxuXG4gIHByaXZhdGUgaXNTZXJpZVZhbHVlRXF1YWxaZXJvKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnNlcmllcy5sZW5ndGggJiYgdGhpcy5zZXJpZXNbMF0udmFsdWUgPT09IDA7XG4gIH1cblxuICBwcml2YXRlIG9uTW91c2VDbGljaygpIHtcbiAgICBsZXQgc2VyaWVPbkNsaWNrOiBQb0RvbnV0Q2hhcnRTZXJpZXMgfCBQb1BpZUNoYXJ0U2VyaWVzIHwgUG9DaGFydEdhdWdlU2VyaWU7XG5cbiAgICBpZiAodGhpcy5pc0NoYXJ0R2F1Z2VUeXBlKSB7XG4gICAgICBjb25zdCB7IGNvbG9yLCAuLi5zZXJpZSB9ID0gdGhpcy5zZXJpZXNbMF07XG4gICAgICBzZXJpZU9uQ2xpY2sgPSBzZXJpZTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2VyaWVPbkNsaWNrID0geyBjYXRlZ29yeTogdGhpcy5jaGFydEVsZW1lbnRDYXRlZ29yeSwgdmFsdWU6IHRoaXMuY2hhcnRFbGVtZW50VmFsdWUgfTtcbiAgICB9XG5cbiAgICB0aGlzLm9uU2VyaWVDbGljay5uZXh0KHNlcmllT25DbGljayk7XG4gIH1cblxuICBwcml2YXRlIG9uTW91c2VFbnRlcihldmVudCkge1xuICAgIGxldCBzZXJpZU9uRW50ZXI6IFBvRG9udXRDaGFydFNlcmllcyB8IFBvUGllQ2hhcnRTZXJpZXMgfCBQb0NoYXJ0R2F1Z2VTZXJpZTtcblxuICAgIGlmICghdGhpcy5pc0NoYXJ0R2F1Z2VUeXBlKSB7XG4gICAgICB0aGlzLnRvb2x0aXBFbGVtZW50ID0gdGhpcy5jaGFydEJvZHkubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcucG8tY2hhcnQtdG9vbHRpcCcpO1xuICAgICAgdGhpcy5jaGFydEVsZW1lbnRDYXRlZ29yeSA9IGV2ZW50LnRhcmdldC5nZXRBdHRyaWJ1dGVOUyhudWxsLCAnZGF0YS10b29sdGlwLWNhdGVnb3J5Jyk7XG4gICAgICB0aGlzLmNoYXJ0RWxlbWVudFZhbHVlID0gZXZlbnQudGFyZ2V0LmdldEF0dHJpYnV0ZU5TKG51bGwsICdkYXRhLXRvb2x0aXAtdmFsdWUnKTtcbiAgICAgIHRoaXMudG9vbHRpcFRleHQgPSBldmVudC50YXJnZXQuZ2V0QXR0cmlidXRlTlMobnVsbCwgJ2RhdGEtdG9vbHRpcC10ZXh0Jyk7XG4gICAgICB0aGlzLnNob3dUb29sdGlwKCk7XG4gICAgICB0aGlzLmNoYW5nZVRvb2x0aXBQb3NpdGlvbihldmVudCk7XG5cbiAgICAgIHNlcmllT25FbnRlciA9IHsgY2F0ZWdvcnk6IHRoaXMuY2hhcnRFbGVtZW50Q2F0ZWdvcnksIHZhbHVlOiB0aGlzLmNoYXJ0RWxlbWVudFZhbHVlIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHsgY29sb3IsIC4uLnNlcmllIH0gPSB0aGlzLnNlcmllc1swXTtcblxuICAgICAgdGhpcy5jaGFydEVsZW1lbnREZXNjcmlwdGlvbiA9IGV2ZW50LnRhcmdldC5nZXRBdHRyaWJ1dGVOUyhudWxsLCAnZGF0YS10b29sdGlwLWNhdGVnb3J5Jyk7XG4gICAgICBzZXJpZU9uRW50ZXIgPSBzZXJpZTtcbiAgICB9XG5cbiAgICB0aGlzLmVtaXRFdmVudE9uRW50ZXIoc2VyaWVPbkVudGVyKTtcbiAgfVxuXG4gIHByaXZhdGUgb25XaW5kb3dSZXNpemUoKSB7XG4gICAgdGhpcy5jYWxjdWxhdGVTVkdEaW1lbnNpb25zKCk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUodGhpcy5zdmdFbGVtZW50LCAnd2lkdGgnLCBgJHt0aGlzLmNlbnRlclh9YCk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUodGhpcy5zdmdFbGVtZW50LCAnaGVpZ2h0JywgYCR7dGhpcy5zdmdIZWlnaHR9YCk7XG4gICAgdGhpcy53aW5kb3dSZXNpemVFbWl0dGVyLm5leHQoKTtcbiAgfVxuXG4gIHByaXZhdGUgcmVtb3ZlV2luZG93UmVzaXplTGlzdGVuZXIoKSB7XG4gICAgaWYgKHRoaXMud2luZG93UmVzaXplTGlzdGVuZXIpIHtcbiAgICAgIHRoaXMud2luZG93UmVzaXplTGlzdGVuZXIoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlbW92ZVdpbmRvd1Njcm9sbExpc3RlbmVyKCkge1xuICAgIGlmICh0aGlzLndpbmRvd1Njcm9sbExpc3RlbmVyKSB7XG4gICAgICB0aGlzLndpbmRvd1Njcm9sbExpc3RlbmVyKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICBsZXQgY2hhcnRTZXJpZXM6IEFycmF5PHN0cmluZz4gPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBvLXBhdGgtaXRlbScpO1xuICAgIGNoYXJ0U2VyaWVzID0gQXJyYXkuZnJvbShjaGFydFNlcmllcyk7XG4gICAgY2hhcnRTZXJpZXMuZm9yRWFjaChzZXJpZSA9PiB7XG4gICAgICB0aGlzLnJlbmRlcmVyLmxpc3RlbihzZXJpZSwgJ2NsaWNrJywgdGhpcy5vbk1vdXNlQ2xpY2suYmluZCh0aGlzKSk7XG4gICAgICB0aGlzLnJlbmRlcmVyLmxpc3RlbihzZXJpZSwgJ21vdXNlZW50ZXInLCB0aGlzLm9uTW91c2VFbnRlci5iaW5kKHRoaXMpKTtcblxuICAgICAgaWYgKCF0aGlzLmlzQ2hhcnRHYXVnZVR5cGUpIHtcbiAgICAgICAgdGhpcy5yZW5kZXJlci5saXN0ZW4oc2VyaWUsICdtb3VzZW1vdmUnLCB0aGlzLmNoYW5nZVRvb2x0aXBQb3NpdGlvbi5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy5yZW5kZXJlci5saXN0ZW4oc2VyaWUsICdtb3VzZWxlYXZlJywgdGhpcy5yZW1vdmVUb29sdGlwLmJpbmQodGhpcykpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGhpcy53aW5kb3dSZXNpemVMaXN0ZW5lciA9IHRoaXMucmVuZGVyZXIubGlzdGVuKHdpbmRvdywgJ3Jlc2l6ZScsIHRoaXMub25XaW5kb3dSZXNpemUuYmluZCh0aGlzKSk7XG4gICAgdGhpcy53aW5kb3dTY3JvbGxMaXN0ZW5lciA9IHRoaXMucmVuZGVyZXIubGlzdGVuKFxuICAgICAgdGhpcy5jaGVja2luZ0lmU2Nyb2xsc1dpdGhQb1BhZ2UoKSxcbiAgICAgICdzY3JvbGwnLFxuICAgICAgdGhpcy5yZW1vdmVUb29sdGlwLmJpbmQodGhpcylcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRJbm5lclJhZGl1cyh0eXBlOiBQb0NoYXJ0VHlwZSkge1xuICAgIGxldCBzZXJpZVdpZHRoO1xuXG4gICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICBjYXNlIFBvQ2hhcnRUeXBlLkRvbnV0OiB7XG4gICAgICAgIHNlcmllV2lkdGggPSBwb0NoYXJ0RG9udXRTZXJpZVdpZHRoO1xuXG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBQb0NoYXJ0VHlwZS5HYXVnZToge1xuICAgICAgICBzZXJpZVdpZHRoID0gcG9DaGFydEdhdWdlU2VyaWVXaWR0aDtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFBvQ2hhcnRUeXBlLlBpZToge1xuICAgICAgICByZXR1cm4gMDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5jZW50ZXJYIC0gdGhpcy5jZW50ZXJYICogc2VyaWVXaWR0aDtcbiAgfVxuXG4gIHByaXZhdGUgc2V0VGV4dFByb3BlcnRpZXModGV4dCwgc3RhcnRBbmdsZTogbnVtYmVyLCBlbmRBbmdsZTogbnVtYmVyKSB7XG4gICAgLy8gbmVjZXNzw6FyaW8gdGV4dC5nZXRDbGllbnRSZWN0cygpLmxlbmd0aCBwYXJhIGNvbnRvcm5hciBlcnJvIGRlIGNvbnNvbGUgY2F1c2FkbyBubyBGaXJlZm94XG4gICAgaWYgKHRoaXMudHlwZSA9PT0gUG9DaGFydFR5cGUuRG9udXQgJiYgdGV4dC5nZXRDbGllbnRSZWN0cygpLmxlbmd0aCkge1xuICAgICAgLy8gdXRpbGl6YWRvIHBhcmEgcmVjdXBlcmFyIG8gYW5ndWxvIGRvIG1laW8sIGVudHJlIG8gaW5pY2lvIGUgZmltIHBhcmEgY2VudHJhbGl6YXIgbyB0ZXh0b1xuICAgICAgY29uc3QgY2VudGVyQW5nbGUgPSAoc3RhcnRBbmdsZSArIGVuZEFuZ2xlKSAvIDI7XG4gICAgICBjb25zdCB0ZXh0Qm94ID0gdGV4dC5nZXRCQm94KCk7XG5cbiAgICAgIGNvbnN0IGhhbGZUZXh0V2lkdGggPSB0ZXh0Qm94LndpZHRoIC8gMjtcbiAgICAgIGNvbnN0IGhhbGZUZXh0SGVpZ2h0ID0gdGV4dEJveC5oZWlnaHQgLyAyO1xuXG4gICAgICAvLyByYWRpdXMgaW50ZXJubyAoY2lyY3VsbyBicmFuY28pICsgYSBtZXRhZGUgZGEgZGlmZXJlbsOnYSBlbnRyZSB0YW1hbmhvIGRvIGNlbnRybyBlIHJhZGl1cyBpbnRlcm5vXG4gICAgICBjb25zdCByYWRpdXMgPSB0aGlzLmlubmVyUmFkaXVzICsgKHRoaXMuY2VudGVyWCAtIHRoaXMuaW5uZXJSYWRpdXMpIC8gMjtcblxuICAgICAgY29uc3QgeENvb3JkaW5hdGUgPSByYWRpdXMgKiBNYXRoLmNvcyhjZW50ZXJBbmdsZSkgKyB0aGlzLmNlbnRlclggLSBoYWxmVGV4dFdpZHRoO1xuICAgICAgY29uc3QgeUNvb3JkaW5hdGUgPSByYWRpdXMgKiBNYXRoLnNpbihjZW50ZXJBbmdsZSkgKyB0aGlzLmNlbnRlclggKyBoYWxmVGV4dEhlaWdodCAvIDI7XG4gICAgICB0ZXh0LnNldEF0dHJpYnV0ZSgneCcsIHhDb29yZGluYXRlKTtcbiAgICAgIHRleHQuc2V0QXR0cmlidXRlKCd5JywgeUNvb3JkaW5hdGUpO1xuICAgICAgdGV4dC5zZXRBdHRyaWJ1dGUoJ2ZpbGwtb3BhY2l0eScsICcxJyk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXRUb29sdGlwUG9zaXRpb25zKGV2ZW50OiBNb3VzZUV2ZW50KSB7XG4gICAgY29uc3QgZGlzcGxhY2VtZW50OiBudW1iZXIgPSA4O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGxlZnQ6IGV2ZW50LmNsaWVudFggLSB0aGlzLnRvb2x0aXBFbGVtZW50Lm9mZnNldFdpZHRoIC8gMixcbiAgICAgIHRvcDogZXZlbnQuY2xpZW50WSAtIHRoaXMudG9vbHRpcEVsZW1lbnQub2Zmc2V0SGVpZ2h0IC0gZGlzcGxhY2VtZW50XG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0RWxlbWVudEF0dHJpYnV0ZXMoc3ZnRWxlbWVudCwgc2VyaWUpIHtcbiAgICBjb25zdCB7IHZhbHVlLCBjYXRlZ29yeSwgdG9vbHRpcCwgZGVzY3JpcHRpb24gfSA9IHNlcmllO1xuXG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUoc3ZnRWxlbWVudCwgJ2RhdGEtdG9vbHRpcC12YWx1ZScsIGAke3ZhbHVlfWApO1xuXG4gICAgaWYgKHRoaXMuaXNDaGFydEdhdWdlVHlwZSkge1xuICAgICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUoc3ZnRWxlbWVudCwgJ2RhdGEtdG9vbHRpcC1kZXNjcmlwdGlvbicsIGRlc2NyaXB0aW9uKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgdG9vbHRpcFZhbHVlID0gdGhpcy5nZXRUb29sdGlwVmFsdWUodmFsdWUpO1xuXG4gICAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZShzdmdFbGVtZW50LCAnZGF0YS10b29sdGlwLWNhdGVnb3J5JywgY2F0ZWdvcnkpO1xuICAgICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUoc3ZnRWxlbWVudCwgJ2RhdGEtdG9vbHRpcC10ZXh0JywgdG9vbHRpcCB8fCBgJHtjYXRlZ29yeX06ICR7dG9vbHRpcFZhbHVlfWApO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2hvd1Rvb2x0aXAoKSB7XG4gICAgdGhpcy5yZW5kZXJlci5yZW1vdmVDbGFzcyh0aGlzLnRvb2x0aXBFbGVtZW50LCAncG8taW52aXNpYmxlJyk7XG4gIH1cbn1cbiJdfQ==