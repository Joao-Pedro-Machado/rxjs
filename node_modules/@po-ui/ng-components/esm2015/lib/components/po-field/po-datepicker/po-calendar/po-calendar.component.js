import { Component, ElementRef, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { isMobile, setYearFrom0To100, validateDateRange } from '../../../../utils/util';
import { PoCalendarLangService } from './po-calendar.lang.service';
import { PoCalendarService } from './po-calendar.service';
const poCalendarLocaleDefault = 'pt';
const poCalendarLocales = ['pt', 'en', 'es'];
/**
 * @docsPrivate
 *
 * @description
 *
 * Componente de calendário de uso interno
 */
export class PoCalendarComponent {
    constructor(poCalendarService, poCalendarLangService) {
        this.poCalendarService = poCalendarService;
        this.poCalendarLangService = poCalendarLangService;
        this.dayVisible = false;
        this.displayMonths = Array();
        this.displayWeedDays = Array();
        this.monthVisible = false;
        this.overlayInvisible = true;
        this.visible = false;
        this.yearVisible = false;
        this.isMobile = isMobile;
        this.today = new Date();
        this.selectedDateChange = new EventEmitter();
        this.submit = new EventEmitter();
    }
    /**
     * @optional
     *
     * @description
     *
     * Data máxima possível de ser selecionada no calendário.
     */
    set dateEnd(val) {
        if (val && val instanceof Date) {
            const year = val.getFullYear();
            const month = val.getMonth();
            const day = val.getDate();
            const date = new Date(year, month, day, 23, 59, 59);
            setYearFrom0To100(date, year);
            this._dateEnd = date;
        }
        else {
            this._dateEnd = undefined;
        }
    }
    get dateEnd() {
        return this._dateEnd;
    }
    /**
     * @optional
     *
     * @description
     *
     * Idioma do calendário.
     *
     * Valores válidos:
     *  - `pt`
     *  - `en`
     *  - `es`
     */
    set locale(locale) {
        this._locale = poCalendarLocales.includes(locale) ? locale : poCalendarLocaleDefault;
        this.initializeLanguage();
    }
    get locale() {
        return this._locale;
    }
    /**
     * @optional
     *
     * @description
     *
     * Data selecionada no calendário.
     */
    set selectedDate(selectedDate) {
        this._selectedDate = selectedDate && selectedDate instanceof Date ? selectedDate : undefined;
    }
    get selectedDate() {
        return this._selectedDate;
    }
    /**
     * @optional
     *
     * @description
     *
     * Data mínima possível de ser selecionada no calendário.
     */
    set dateStart(val) {
        if (val && val instanceof Date) {
            const year = val.getFullYear();
            const month = val.getMonth();
            const day = val.getDate();
            const date = new Date(year, month, day, 0, 0, 0);
            setYearFrom0To100(date, year);
            this._dateStart = date;
        }
        else {
            this._dateStart = undefined;
        }
    }
    get dateStart() {
        return this._dateStart;
    }
    close() {
        this.overlayInvisible = true;
        this.visible = false;
    }
    // Obtém um array de todos os anos desta década
    getArrayDecade(year) {
        this.displayDecade = Array();
        if (year % 10 !== 0) {
            while (year % 10 !== 0) {
                year--;
            }
        }
        this.updateDecade(year);
    }
    getBackgroundColor(displayValue, propertyValue) {
        return displayValue === propertyValue ? 'po-calendar-box-background-selected' : 'po-calendar-box-background';
    }
    getDayBackgroundColor(date) {
        if (this.equalsDate(date, this.selectedDate)) {
            return 'po-calendar-box-background-selected';
        }
        else if (this.equalsDate(date, this.today)) {
            return 'po-calendar-box-background-today';
        }
        else if (date) {
            if (validateDateRange(date, this.dateStart, this.dateEnd)) {
                return 'po-calendar-box-background';
            }
            else {
                return 'po-calendar-box-background-disabled';
            }
        }
        else {
            return '';
        }
    }
    getDayForegroundColor(date) {
        if (this.equalsDate(date, this.selectedDate)) {
            return 'po-calendar-box-foreground-selected';
        }
        else if (this.equalsDate(date, this.today)) {
            return 'po-calendar-box-foreground-today';
        }
        else {
            if (validateDateRange(date, this.dateStart, this.dateEnd)) {
                return 'po-calendar-box-foreground';
            }
            else {
                return 'po-calendar-box-foreground-disabled';
            }
        }
    }
    getForegroundColor(displayValue, propertyValue) {
        return displayValue === propertyValue ? 'po-calendar-box-foreground-selected' : 'po-calendar-box-foreground';
    }
    getWordMonth() {
        return this.poCalendarLangService.getWordMonth();
    }
    getWordYear() {
        return this.poCalendarLangService.getWordYear();
    }
    init() {
        this.selectedDate ? this.updateDate(this.selectedDate) : this.updateDate(this.today);
        this.initializeLanguage();
        this.selectDay();
        if (this.isMobile()) {
            this.overlayInvisible = false;
        }
        this.visible = true;
    }
    initializeLanguage() {
        this.poCalendarLangService.setLanguage(this.locale);
        this.displayWeedDays = this.poCalendarLangService.getArrayWeekDays();
        this.displayMonths = this.poCalendarLangService.getArrayMonths();
    }
    onNextMonth() {
        if (this.displayMonthNumber < 11) {
            this.updateDisplay(this.displayYear, this.displayMonthNumber + 1);
        }
        else {
            this.updateDisplay(this.displayYear + 1, 0);
        }
    }
    onPrevMonth() {
        if (this.displayMonthNumber > 0) {
            this.updateDisplay(this.displayYear, this.displayMonthNumber - 1);
        }
        else {
            this.updateDisplay(this.displayYear - 1, 11);
        }
    }
    // Ao selecionar uma data
    onSelectDate(date) {
        if (validateDateRange(date, this.dateStart, this.dateEnd)) {
            this.selectedDate = date;
            this.selectedDateChange.emit(date);
            this.submit.emit(date);
        }
    }
    // Ao selecionar um mês
    onSelectMonth(year, month) {
        this.selectDay();
        this.updateDisplay(year, month);
    }
    // Ao selecionar um ano
    onSelectYear(year, month) {
        // Se veio da tela de seleção de mês
        this.lastDisplay === 'month' ? this.selectMonth() : this.selectDay();
        this.currentYear = year;
        this.updateDisplay(year, month);
    }
    selectDay() {
        this.dayVisible = true;
        this.monthVisible = false;
        this.yearVisible = false;
        this.lastDisplay = 'day';
    }
    selectMonth() {
        this.dayVisible = false;
        this.monthVisible = true;
        this.yearVisible = false;
        this.lastDisplay = 'month';
    }
    selectYear() {
        this.dayVisible = false;
        this.monthVisible = false;
        this.yearVisible = true;
    }
    setMobileVisualization() {
        return this.isMobile() ? 'po-calendar po-calendar-mobile' : 'po-calendar';
    }
    updateYear(value) {
        this.updateDisplay(this.displayYear + value, this.displayMonthNumber);
    }
    addAllYearsInDecade(year) {
        let i;
        for (i = year; i < year + 10; i++) {
            this.displayDecade.push(i);
        }
    }
    equalsDate(date1, date2) {
        try {
            return (date1.getFullYear() === date2.getFullYear() &&
                date1.getMonth() === date2.getMonth() &&
                date1.getDate() === date2.getDate());
        }
        catch (error) {
            return false;
        }
    }
    updateDate(date) {
        this.currentMonthNumber = date.getMonth();
        this.currentYear = date.getFullYear();
        this.updateDisplay(this.currentYear, this.currentMonthNumber);
    }
    updateDecade(year) {
        this.addAllYearsInDecade(year);
        this.displayStartDecade = year;
        this.displayFinalDecade = year + 9;
    }
    updateDisplay(year, month) {
        const calendarArray = this.poCalendarService.monthDays(year, month);
        this.displayDays = [].concat.apply([], calendarArray);
        this.displayMonthNumber = month;
        this.displayMonth = this.displayMonths[month];
        this.displayYear = year;
        this.getArrayDecade(year);
    }
}
PoCalendarComponent.decorators = [
    { type: Component, args: [{
                selector: 'po-calendar',
                template: "<div class=\"po-calendar-overlay\" [class.po-invisible]=\"overlayInvisible\"></div>\n<div *ngIf=\"visible\" [ngClass]=\"setMobileVisualization()\">\n  <div *ngIf=\"dayVisible\" #days>\n    <div class=\"po-calendar-nav\">\n      <span (click)=\"onPrevMonth()\" class=\"po-calendar-nav-left po-icon po-icon-arrow-left\"></span>\n      <div class=\"po-calendar-nav-title\" attr-calendar>\n        <span class=\"po-clickable po-mr-1\" (click)=\"selectMonth()\">{{ displayMonth }}</span>\n        <span class=\"po-clickable\" (click)=\"selectYear()\">{{ displayYear }}</span>\n      </div>\n      <span (click)=\"onNextMonth()\" class=\"po-calendar-nav-right po-icon po-icon-arrow-right\"></span>\n    </div>\n    <div class=\"po-calendar-content\">\n      <div class=\"po-calendar-labels\">\n        <div class=\"po-calendar-label\" *ngFor=\"let day of displayWeedDays\">\n          {{ day.toLowerCase() }}\n        </div>\n      </div>\n      <div class=\"po-calendar-content-list-day\">\n        <div\n          *ngFor=\"let day of displayDays\"\n          class=\"po-calendar-day po-calendar-box-background\"\n          (click)=\"onSelectDate(day)\"\n          [ngClass]=\"getDayBackgroundColor(day)\"\n        >\n          <span *ngIf=\"day != 0\" [ngClass]=\"getDayForegroundColor(day)\">\n            {{ day.getDate() }}\n          </span>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div *ngIf=\"monthVisible\" #months>\n    <div class=\"po-calendar-nav\">\n      <span (click)=\"updateYear(-1)\" class=\"po-calendar-nav-left po-icon po-icon-arrow-left\"></span>\n      <div class=\"po-calendar-nav-title\" attr-calendar>\n        <span class=\"po-clickable\" (click)=\"selectYear()\">{{ displayYear }}</span>\n      </div>\n      <span (click)=\"updateYear(1)\" class=\"po-calendar-nav-right po-icon po-icon-arrow-right\"></span>\n    </div>\n    <div class=\"po-calendar-content\">\n      <div class=\"po-calendar-labels\">\n        <div class=\"po-calendar-label\">\n          {{ getWordMonth() }}\n        </div>\n      </div>\n      <div class=\"po-calendar-content-list-month\">\n        <div\n          *ngFor=\"let month of displayMonths; let i = index\"\n          class=\"po-calendar-month\"\n          (click)=\"onSelectMonth(displayYear, i)\"\n          [ngClass]=\"getBackgroundColor(i, displayMonthNumber)\"\n          attr-calendar\n        >\n          <span [ngClass]=\"getForegroundColor(i, displayMonthNumber)\">\n            {{ month }}\n          </span>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div *ngIf=\"yearVisible\" #years>\n    <div class=\"po-calendar-nav\">\n      <span (click)=\"updateYear(-10)\" class=\"po-calendar-nav-left po-icon po-icon-arrow-left\"></span>\n      <div class=\"po-calendar-nav-title\">{{ displayStartDecade }} - {{ displayFinalDecade }}</div>\n      <span (click)=\"updateYear(10)\" class=\"po-calendar-nav-right po-icon po-icon-arrow-right\"></span>\n    </div>\n    <div class=\"po-calendar-content\">\n      <div class=\"po-calendar-labels\">\n        <div class=\"po-calendar-label\">\n          {{ getWordYear() }}\n        </div>\n      </div>\n      <div class=\"po-calendar-content-list-year\">\n        <div\n          *ngFor=\"let year of displayDecade; let i = index\"\n          class=\"po-calendar-year\"\n          (click)=\"onSelectYear(year, displayMonthNumber)\"\n          [ngClass]=\"getBackgroundColor(year, currentYear)\"\n          attr-calendar\n        >\n          <span [ngClass]=\"getForegroundColor(year, currentYear)\">\n            {{ year }}\n          </span>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n",
                providers: [PoCalendarService, PoCalendarLangService]
            },] }
];
PoCalendarComponent.ctorParameters = () => [
    { type: PoCalendarService },
    { type: PoCalendarLangService }
];
PoCalendarComponent.propDecorators = {
    elDays: [{ type: ViewChild, args: ['days', { read: ElementRef, static: true },] }],
    elMonths: [{ type: ViewChild, args: ['months', { read: ElementRef, static: true },] }],
    elYears: [{ type: ViewChild, args: ['years', { read: ElementRef, static: true },] }],
    dateEnd: [{ type: Input, args: ['p-date-end',] }],
    locale: [{ type: Input, args: ['p-locale',] }],
    selectedDate: [{ type: Input, args: ['p-selected-date',] }],
    dateStart: [{ type: Input, args: ['p-date-start',] }],
    selectedDateChange: [{ type: Output, args: ['p-selected-dateChange',] }],
    submit: [{ type: Output, args: ['p-submit',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tY2FsZW5kYXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvdWkvc3JjL2xpYi9jb21wb25lbnRzL3BvLWZpZWxkL3BvLWRhdGVwaWNrZXIvcG8tY2FsZW5kYXIvcG8tY2FsZW5kYXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUU5RixPQUFPLEVBQUUsUUFBUSxFQUFFLGlCQUFpQixFQUFFLGlCQUFpQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDeEYsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDbkUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFFMUQsTUFBTSx1QkFBdUIsR0FBRyxJQUFJLENBQUM7QUFDckMsTUFBTSxpQkFBaUIsR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7QUFFN0M7Ozs7OztHQU1HO0FBTUgsTUFBTSxPQUFPLG1CQUFtQjtJQXNIOUIsWUFBb0IsaUJBQW9DLEVBQVUscUJBQTRDO1FBQTFGLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBbUI7UUFBVSwwQkFBcUIsR0FBckIscUJBQXFCLENBQXVCO1FBL0c5RyxlQUFVLEdBQVksS0FBSyxDQUFDO1FBTTVCLGtCQUFhLEdBQWUsS0FBSyxFQUFFLENBQUM7UUFFcEMsb0JBQWUsR0FBZSxLQUFLLEVBQUUsQ0FBQztRQUV0QyxpQkFBWSxHQUFZLEtBQUssQ0FBQztRQUM5QixxQkFBZ0IsR0FBWSxJQUFJLENBQUM7UUFDakMsWUFBTyxHQUFZLEtBQUssQ0FBQztRQUN6QixnQkFBVyxHQUFZLEtBQUssQ0FBQztRQUdyQixhQUFR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IHsgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBFdmVudEVtaXR0ZXIsIElucHV0LCBPdXRwdXQsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBpc01vYmlsZSwgc2V0WWVhckZyb20wVG8xMDAsIHZhbGlkYXRlRGF0ZVJhbmdlIH0gZnJvbSAnLi4vLi4vLi4vLi4vdXRpbHMvdXRpbCc7XG5pbXBvcnQgeyBQb0NhbGVuZGFyTGFuZ1NlcnZpY2UgfSBmcm9tICcuL3BvLWNhbGVuZGFyLmxhbmcuc2VydmljZSc7XG5pbXBvcnQgeyBQb0NhbGVuZGFyU2VydmljZSB9IGZyb20gJy4vcG8tY2FsZW5kYXIuc2VydmljZSc7XG5cbmNvbnN0IHBvQ2FsZW5kYXJMb2NhbGVEZWZhdWx0ID0gJ3B0JztcbmNvbnN0IHBvQ2FsZW5kYXJMb2NhbGVzID0gWydwdCcsICdlbicsICdlcyddO1xuXG4vKipcbiAqIEBkb2NzUHJpdmF0ZVxuICpcbiAqIEBkZXNjcmlwdGlvblxuICpcbiAqIENvbXBvbmVudGUgZGUgY2FsZW5kw6FyaW8gZGUgdXNvIGludGVybm9cbiAqL1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAncG8tY2FsZW5kYXInLFxuICB0ZW1wbGF0ZVVybDogJy4vcG8tY2FsZW5kYXIuY29tcG9uZW50Lmh0bWwnLFxuICBwcm92aWRlcnM6IFtQb0NhbGVuZGFyU2VydmljZSwgUG9DYWxlbmRhckxhbmdTZXJ2aWNlXVxufSlcbmV4cG9ydCBjbGFzcyBQb0NhbGVuZGFyQ29tcG9uZW50IHtcbiAgcHJpdmF0ZSBfZGF0ZUVuZDogRGF0ZTtcbiAgcHJpdmF0ZSBfZGF0ZVN0YXJ0OiBEYXRlO1xuICBwcml2YXRlIF9sb2NhbGU6IHN0cmluZztcbiAgcHJpdmF0ZSBfc2VsZWN0ZWREYXRlPzogRGF0ZTtcblxuICBjdXJyZW50WWVhcjogbnVtYmVyO1xuICBkYXlWaXNpYmxlOiBib29sZWFuID0gZmFsc2U7XG4gIGRpc3BsYXlEYXlzOiBBcnJheTxudW1iZXI+O1xuICBkaXNwbGF5RGVjYWRlOiBBcnJheTxudW1iZXI+O1xuICBkaXNwbGF5RmluYWxEZWNhZGU6IG51bWJlcjtcbiAgZGlzcGxheU1vbnRoOiBhbnk7XG4gIGRpc3BsYXlNb250aE51bWJlcjogbnVtYmVyO1xuICBkaXNwbGF5TW9udGhzOiBBcnJheTxhbnk+ID0gQXJyYXkoKTtcbiAgZGlzcGxheVN0YXJ0RGVjYWRlOiBudW1iZXI7XG4gIGRpc3BsYXlXZWVkRGF5czogQXJyYXk8YW55PiA9IEFycmF5KCk7XG4gIGRpc3BsYXlZZWFyOiBudW1iZXI7XG4gIG1vbnRoVmlzaWJsZTogYm9vbGVhbiA9IGZhbHNlO1xuICBvdmVybGF5SW52aXNpYmxlOiBib29sZWFuID0gdHJ1ZTtcbiAgdmlzaWJsZTogYm9vbGVhbiA9IGZhbHNlO1xuICB5ZWFyVmlzaWJsZTogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIHByaXZhdGUgY3VycmVudE1vbnRoTnVtYmVyOiBudW1iZXI7XG4gIHByaXZhdGUgaXNNb2JpbGU6IGFueSA9IGlzTW9iaWxlO1xuICBwcml2YXRlIGxhc3REaXNwbGF5OiBzdHJpbmc7XG4gIHByaXZhdGUgdG9kYXk6IERhdGUgPSBuZXcgRGF0ZSgpO1xuXG4gIEBWaWV3Q2hpbGQoJ2RheXMnLCB7IHJlYWQ6IEVsZW1lbnRSZWYsIHN0YXRpYzogdHJ1ZSB9KSBlbERheXM6IEVsZW1lbnRSZWY7XG4gIEBWaWV3Q2hpbGQoJ21vbnRocycsIHsgcmVhZDogRWxlbWVudFJlZiwgc3RhdGljOiB0cnVlIH0pIGVsTW9udGhzOiBFbGVtZW50UmVmO1xuICBAVmlld0NoaWxkKCd5ZWFycycsIHsgcmVhZDogRWxlbWVudFJlZiwgc3RhdGljOiB0cnVlIH0pIGVsWWVhcnM6IEVsZW1lbnRSZWY7XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogRGF0YSBtw6F4aW1hIHBvc3PDrXZlbCBkZSBzZXIgc2VsZWNpb25hZGEgbm8gY2FsZW5kw6FyaW8uXG4gICAqL1xuICBASW5wdXQoJ3AtZGF0ZS1lbmQnKSBzZXQgZGF0ZUVuZCh2YWw6IERhdGUpIHtcbiAgICBpZiAodmFsICYmIHZhbCBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgIGNvbnN0IHllYXIgPSB2YWwuZ2V0RnVsbFllYXIoKTtcbiAgICAgIGNvbnN0IG1vbnRoID0gdmFsLmdldE1vbnRoKCk7XG4gICAgICBjb25zdCBkYXkgPSB2YWwuZ2V0RGF0ZSgpO1xuXG4gICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoeWVhciwgbW9udGgsIGRheSwgMjMsIDU5LCA1OSk7XG4gICAgICBzZXRZZWFyRnJvbTBUbzEwMChkYXRlLCB5ZWFyKTtcblxuICAgICAgdGhpcy5fZGF0ZUVuZCA9IGRhdGU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2RhdGVFbmQgPSB1bmRlZmluZWQ7XG4gICAgfVxuICB9XG4gIGdldCBkYXRlRW5kKCkge1xuICAgIHJldHVybiB0aGlzLl9kYXRlRW5kO1xuICB9XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogSWRpb21hIGRvIGNhbGVuZMOhcmlvLlxuICAgKlxuICAgKiBWYWxvcmVzIHbDoWxpZG9zOlxuICAgKiAgLSBgcHRgXG4gICAqICAtIGBlbmBcbiAgICogIC0gYGVzYFxuICAgKi9cbiAgQElucHV0KCdwLWxvY2FsZScpIHNldCBsb2NhbGUobG9jYWxlOiBzdHJpbmcpIHtcbiAgICB0aGlzLl9sb2NhbGUgPSBwb0NhbGVuZGFyTG9jYWxlcy5pbmNsdWRlcyhsb2NhbGUpID8gbG9jYWxlIDogcG9DYWxlbmRhckxvY2FsZURlZmF1bHQ7XG4gICAgdGhpcy5pbml0aWFsaXplTGFuZ3VhZ2UoKTtcbiAgfVxuICBnZXQgbG9jYWxlKCkge1xuICAgIHJldHVybiB0aGlzLl9sb2NhbGU7XG4gIH1cblxuICAvKipcbiAgICogQG9wdGlvbmFsXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiBEYXRhIHNlbGVjaW9uYWRhIG5vIGNhbGVuZMOhcmlvLlxuICAgKi9cbiAgQElucHV0KCdwLXNlbGVjdGVkLWRhdGUnKSBzZXQgc2VsZWN0ZWREYXRlKHNlbGVjdGVkRGF0ZTogRGF0ZSkge1xuICAgIHRoaXMuX3NlbGVjdGVkRGF0ZSA9IHNlbGVjdGVkRGF0ZSAmJiBzZWxlY3RlZERhdGUgaW5zdGFuY2VvZiBEYXRlID8gc2VsZWN0ZWREYXRlIDogdW5kZWZpbmVkO1xuICB9XG4gIGdldCBzZWxlY3RlZERhdGUoKTogRGF0ZSB7XG4gICAgcmV0dXJuIHRoaXMuX3NlbGVjdGVkRGF0ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIERhdGEgbcOtbmltYSBwb3Nzw612ZWwgZGUgc2VyIHNlbGVjaW9uYWRhIG5vIGNhbGVuZMOhcmlvLlxuICAgKi9cbiAgQElucHV0KCdwLWRhdGUtc3RhcnQnKSBzZXQgZGF0ZVN0YXJ0KHZhbDogRGF0ZSkge1xuICAgIGlmICh2YWwgJiYgdmFsIGluc3RhbmNlb2YgRGF0ZSkge1xuICAgICAgY29uc3QgeWVhciA9IHZhbC5nZXRGdWxsWWVhcigpO1xuICAgICAgY29uc3QgbW9udGggPSB2YWwuZ2V0TW9udGgoKTtcbiAgICAgIGNvbnN0IGRheSA9IHZhbC5nZXREYXRlKCk7XG5cbiAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSh5ZWFyLCBtb250aCwgZGF5LCAwLCAwLCAwKTtcbiAgICAgIHNldFllYXJGcm9tMFRvMTAwKGRhdGUsIHllYXIpO1xuXG4gICAgICB0aGlzLl9kYXRlU3RhcnQgPSBkYXRlO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9kYXRlU3RhcnQgPSB1bmRlZmluZWQ7XG4gICAgfVxuICB9XG4gIGdldCBkYXRlU3RhcnQoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2RhdGVTdGFydDtcbiAgfVxuXG4gIEBPdXRwdXQoJ3Atc2VsZWN0ZWQtZGF0ZUNoYW5nZScpIHNlbGVjdGVkRGF0ZUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8RGF0ZT4oKTtcbiAgQE91dHB1dCgncC1zdWJtaXQnKSBzdWJtaXQgPSBuZXcgRXZlbnRFbWl0dGVyPERhdGU+KCk7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBwb0NhbGVuZGFyU2VydmljZTogUG9DYWxlbmRhclNlcnZpY2UsIHByaXZhdGUgcG9DYWxlbmRhckxhbmdTZXJ2aWNlOiBQb0NhbGVuZGFyTGFuZ1NlcnZpY2UpIHt9XG5cbiAgY2xvc2UoKSB7XG4gICAgdGhpcy5vdmVybGF5SW52aXNpYmxlID0gdHJ1ZTtcbiAgICB0aGlzLnZpc2libGUgPSBmYWxzZTtcbiAgfVxuXG4gIC8vIE9idMOpbSB1bSBhcnJheSBkZSB0b2RvcyBvcyBhbm9zIGRlc3RhIGTDqWNhZGFcbiAgZ2V0QXJyYXlEZWNhZGUoeWVhcikge1xuICAgIHRoaXMuZGlzcGxheURlY2FkZSA9IEFycmF5KCk7XG5cbiAgICBpZiAoeWVhciAlIDEwICE9PSAwKSB7XG4gICAgICB3aGlsZSAoeWVhciAlIDEwICE9PSAwKSB7XG4gICAgICAgIHllYXItLTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy51cGRhdGVEZWNhZGUoeWVhcik7XG4gIH1cblxuICBnZXRCYWNrZ3JvdW5kQ29sb3IoZGlzcGxheVZhbHVlOiBudW1iZXIsIHByb3BlcnR5VmFsdWU6IG51bWJlcikge1xuICAgIHJldHVybiBkaXNwbGF5VmFsdWUgPT09IHByb3BlcnR5VmFsdWUgPyAncG8tY2FsZW5kYXItYm94LWJhY2tncm91bmQtc2VsZWN0ZWQnIDogJ3BvLWNhbGVuZGFyLWJveC1iYWNrZ3JvdW5kJztcbiAgfVxuXG4gIGdldERheUJhY2tncm91bmRDb2xvcihkYXRlOiBEYXRlKSB7XG4gICAgaWYgKHRoaXMuZXF1YWxzRGF0ZShkYXRlLCB0aGlzLnNlbGVjdGVkRGF0ZSkpIHtcbiAgICAgIHJldHVybiAncG8tY2FsZW5kYXItYm94LWJhY2tncm91bmQtc2VsZWN0ZWQnO1xuICAgIH0gZWxzZSBpZiAodGhpcy5lcXVhbHNEYXRlKGRhdGUsIHRoaXMudG9kYXkpKSB7XG4gICAgICByZXR1cm4gJ3BvLWNhbGVuZGFyLWJveC1iYWNrZ3JvdW5kLXRvZGF5JztcbiAgICB9IGVsc2UgaWYgKGRhdGUpIHtcbiAgICAgIGlmICh2YWxpZGF0ZURhdGVSYW5nZShkYXRlLCB0aGlzLmRhdGVTdGFydCwgdGhpcy5kYXRlRW5kKSkge1xuICAgICAgICByZXR1cm4gJ3BvLWNhbGVuZGFyLWJveC1iYWNrZ3JvdW5kJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiAncG8tY2FsZW5kYXItYm94LWJhY2tncm91bmQtZGlzYWJsZWQnO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gJyc7XG4gICAgfVxuICB9XG5cbiAgZ2V0RGF5Rm9yZWdyb3VuZENvbG9yKGRhdGU6IERhdGUpIHtcbiAgICBpZiAodGhpcy5lcXVhbHNEYXRlKGRhdGUsIHRoaXMuc2VsZWN0ZWREYXRlKSkge1xuICAgICAgcmV0dXJuICdwby1jYWxlbmRhci1ib3gtZm9yZWdyb3VuZC1zZWxlY3RlZCc7XG4gICAgfSBlbHNlIGlmICh0aGlzLmVxdWFsc0RhdGUoZGF0ZSwgdGhpcy50b2RheSkpIHtcbiAgICAgIHJldHVybiAncG8tY2FsZW5kYXItYm94LWZvcmVncm91bmQtdG9kYXknO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAodmFsaWRhdGVEYXRlUmFuZ2UoZGF0ZSwgdGhpcy5kYXRlU3RhcnQsIHRoaXMuZGF0ZUVuZCkpIHtcbiAgICAgICAgcmV0dXJuICdwby1jYWxlbmRhci1ib3gtZm9yZWdyb3VuZCc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gJ3BvLWNhbGVuZGFyLWJveC1mb3JlZ3JvdW5kLWRpc2FibGVkJztcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBnZXRGb3JlZ3JvdW5kQ29sb3IoZGlzcGxheVZhbHVlOiBudW1iZXIsIHByb3BlcnR5VmFsdWU6IG51bWJlcikge1xuICAgIHJldHVybiBkaXNwbGF5VmFsdWUgPT09IHByb3BlcnR5VmFsdWUgPyAncG8tY2FsZW5kYXItYm94LWZvcmVncm91bmQtc2VsZWN0ZWQnIDogJ3BvLWNhbGVuZGFyLWJveC1mb3JlZ3JvdW5kJztcbiAgfVxuXG4gIGdldFdvcmRNb250aCgpIHtcbiAgICByZXR1cm4gdGhpcy5wb0NhbGVuZGFyTGFuZ1NlcnZpY2UuZ2V0V29yZE1vbnRoKCk7XG4gIH1cblxuICBnZXRXb3JkWWVhcigpIHtcbiAgICByZXR1cm4gdGhpcy5wb0NhbGVuZGFyTGFuZ1NlcnZpY2UuZ2V0V29yZFllYXIoKTtcbiAgfVxuXG4gIGluaXQoKSB7XG4gICAgdGhpcy5zZWxlY3RlZERhdGUgPyB0aGlzLnVwZGF0ZURhdGUodGhpcy5zZWxlY3RlZERhdGUpIDogdGhpcy51cGRhdGVEYXRlKHRoaXMudG9kYXkpO1xuXG4gICAgdGhpcy5pbml0aWFsaXplTGFuZ3VhZ2UoKTtcblxuICAgIHRoaXMuc2VsZWN0RGF5KCk7XG5cbiAgICBpZiAodGhpcy5pc01vYmlsZSgpKSB7XG4gICAgICB0aGlzLm92ZXJsYXlJbnZpc2libGUgPSBmYWxzZTtcbiAgICB9XG5cbiAgICB0aGlzLnZpc2libGUgPSB0cnVlO1xuICB9XG5cbiAgaW5pdGlhbGl6ZUxhbmd1YWdlKCkge1xuICAgIHRoaXMucG9DYWxlbmRhckxhbmdTZXJ2aWNlLnNldExhbmd1YWdlKHRoaXMubG9jYWxlKTtcbiAgICB0aGlzLmRpc3BsYXlXZWVkRGF5cyA9IHRoaXMucG9DYWxlbmRhckxhbmdTZXJ2aWNlLmdldEFycmF5V2Vla0RheXMoKTtcbiAgICB0aGlzLmRpc3BsYXlNb250aHMgPSB0aGlzLnBvQ2FsZW5kYXJMYW5nU2VydmljZS5nZXRBcnJheU1vbnRocygpO1xuICB9XG5cbiAgb25OZXh0TW9udGgoKSB7XG4gICAgaWYgKHRoaXMuZGlzcGxheU1vbnRoTnVtYmVyIDwgMTEpIHtcbiAgICAgIHRoaXMudXBkYXRlRGlzcGxheSh0aGlzLmRpc3BsYXlZZWFyLCB0aGlzLmRpc3BsYXlNb250aE51bWJlciArIDEpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnVwZGF0ZURpc3BsYXkodGhpcy5kaXNwbGF5WWVhciArIDEsIDApO1xuICAgIH1cbiAgfVxuXG4gIG9uUHJldk1vbnRoKCkge1xuICAgIGlmICh0aGlzLmRpc3BsYXlNb250aE51bWJlciA+IDApIHtcbiAgICAgIHRoaXMudXBkYXRlRGlzcGxheSh0aGlzLmRpc3BsYXlZZWFyLCB0aGlzLmRpc3BsYXlNb250aE51bWJlciAtIDEpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnVwZGF0ZURpc3BsYXkodGhpcy5kaXNwbGF5WWVhciAtIDEsIDExKTtcbiAgICB9XG4gIH1cblxuICAvLyBBbyBzZWxlY2lvbmFyIHVtYSBkYXRhXG4gIG9uU2VsZWN0RGF0ZShkYXRlOiBEYXRlKSB7XG4gICAgaWYgKHZhbGlkYXRlRGF0ZVJhbmdlKGRhdGUsIHRoaXMuZGF0ZVN0YXJ0LCB0aGlzLmRhdGVFbmQpKSB7XG4gICAgICB0aGlzLnNlbGVjdGVkRGF0ZSA9IGRhdGU7XG4gICAgICB0aGlzLnNlbGVjdGVkRGF0ZUNoYW5nZS5lbWl0KGRhdGUpO1xuICAgICAgdGhpcy5zdWJtaXQuZW1pdChkYXRlKTtcbiAgICB9XG4gIH1cblxuICAvLyBBbyBzZWxlY2lvbmFyIHVtIG3DqnNcbiAgb25TZWxlY3RNb250aCh5ZWFyOiBudW1iZXIsIG1vbnRoOiBudW1iZXIpIHtcbiAgICB0aGlzLnNlbGVjdERheSgpO1xuICAgIHRoaXMudXBkYXRlRGlzcGxheSh5ZWFyLCBtb250aCk7XG4gIH1cblxuICAvLyBBbyBzZWxlY2lvbmFyIHVtIGFub1xuICBvblNlbGVjdFllYXIoeWVhcjogbnVtYmVyLCBtb250aDogbnVtYmVyKSB7XG4gICAgLy8gU2UgdmVpbyBkYSB0ZWxhIGRlIHNlbGXDp8OjbyBkZSBtw6pzXG4gICAgdGhpcy5sYXN0RGlzcGxheSA9PT0gJ21vbnRoJyA/IHRoaXMuc2VsZWN0TW9udGgoKSA6IHRoaXMuc2VsZWN0RGF5KCk7XG5cbiAgICB0aGlzLmN1cnJlbnRZZWFyID0geWVhcjtcbiAgICB0aGlzLnVwZGF0ZURpc3BsYXkoeWVhciwgbW9udGgpO1xuICB9XG5cbiAgc2VsZWN0RGF5KCkge1xuICAgIHRoaXMuZGF5VmlzaWJsZSA9IHRydWU7XG4gICAgdGhpcy5tb250aFZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLnllYXJWaXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5sYXN0RGlzcGxheSA9ICdkYXknO1xuICB9XG5cbiAgc2VsZWN0TW9udGgoKSB7XG4gICAgdGhpcy5kYXlWaXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5tb250aFZpc2libGUgPSB0cnVlO1xuICAgIHRoaXMueWVhclZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLmxhc3REaXNwbGF5ID0gJ21vbnRoJztcbiAgfVxuXG4gIHNlbGVjdFllYXIoKSB7XG4gICAgdGhpcy5kYXlWaXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5tb250aFZpc2libGUgPSBmYWxzZTtcbiAgICB0aGlzLnllYXJWaXNpYmxlID0gdHJ1ZTtcbiAgfVxuXG4gIHNldE1vYmlsZVZpc3VhbGl6YXRpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuaXNNb2JpbGUoKSA/ICdwby1jYWxlbmRhciBwby1jYWxlbmRhci1tb2JpbGUnIDogJ3BvLWNhbGVuZGFyJztcbiAgfVxuXG4gIHVwZGF0ZVllYXIodmFsdWU6IG51bWJlcikge1xuICAgIHRoaXMudXBkYXRlRGlzcGxheSh0aGlzLmRpc3BsYXlZZWFyICsgdmFsdWUsIHRoaXMuZGlzcGxheU1vbnRoTnVtYmVyKTtcbiAgfVxuXG4gIHByaXZhdGUgYWRkQWxsWWVhcnNJbkRlY2FkZSh5ZWFyOiBudW1iZXIpIHtcbiAgICBsZXQgaTtcbiAgICBmb3IgKGkgPSB5ZWFyOyBpIDwgeWVhciArIDEwOyBpKyspIHtcbiAgICAgIHRoaXMuZGlzcGxheURlY2FkZS5wdXNoKGkpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZXF1YWxzRGF0ZShkYXRlMTogRGF0ZSwgZGF0ZTI6IERhdGUpOiBib29sZWFuIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgZGF0ZTEuZ2V0RnVsbFllYXIoKSA9PT0gZGF0ZTIuZ2V0RnVsbFllYXIoKSAmJlxuICAgICAgICBkYXRlMS5nZXRNb250aCgpID09PSBkYXRlMi5nZXRNb250aCgpICYmXG4gICAgICAgIGRhdGUxLmdldERhdGUoKSA9PT0gZGF0ZTIuZ2V0RGF0ZSgpXG4gICAgICApO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVEYXRlKGRhdGU6IERhdGUpIHtcbiAgICB0aGlzLmN1cnJlbnRNb250aE51bWJlciA9IGRhdGUuZ2V0TW9udGgoKTtcbiAgICB0aGlzLmN1cnJlbnRZZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpO1xuICAgIHRoaXMudXBkYXRlRGlzcGxheSh0aGlzLmN1cnJlbnRZZWFyLCB0aGlzLmN1cnJlbnRNb250aE51bWJlcik7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZURlY2FkZSh5ZWFyOiBudW1iZXIpIHtcbiAgICB0aGlzLmFkZEFsbFllYXJzSW5EZWNhZGUoeWVhcik7XG4gICAgdGhpcy5kaXNwbGF5U3RhcnREZWNhZGUgPSB5ZWFyO1xuICAgIHRoaXMuZGlzcGxheUZpbmFsRGVjYWRlID0geWVhciArIDk7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZURpc3BsYXkoeWVhcjogbnVtYmVyLCBtb250aDogbnVtYmVyKSB7XG4gICAgY29uc3QgY2FsZW5kYXJBcnJheSA9IHRoaXMucG9DYWxlbmRhclNlcnZpY2UubW9udGhEYXlzKHllYXIsIG1vbnRoKTtcbiAgICB0aGlzLmRpc3BsYXlEYXlzID0gW10uY29uY2F0LmFwcGx5KFtdLCBjYWxlbmRhckFycmF5KTtcbiAgICB0aGlzLmRpc3BsYXlNb250aE51bWJlciA9IG1vbnRoO1xuICAgIHRoaXMuZGlzcGxheU1vbnRoID0gdGhpcy5kaXNwbGF5TW9udGhzW21vbnRoXTtcbiAgICB0aGlzLmRpc3BsYXlZZWFyID0geWVhcjtcbiAgICB0aGlzLmdldEFycmF5RGVjYWRlKHllYXIpO1xuICB9XG59XG4iXX0=